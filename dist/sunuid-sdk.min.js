!function(){"use strict";function e(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=Array(n);t<n;t++)r[t]=e[t];return r}function n(e,n,t,r,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void t(e)}a.done?n(c):Promise.resolve(c).then(r,i)}function t(e){return function(){var t=this,r=arguments;return new Promise(function(i,o){var s=e.apply(t,r);function a(e){n(s,i,o,a,c,"next",e)}function c(e){n(s,i,o,a,c,"throw",e)}a(void 0)})}}function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,d(r.key),r)}}function i(e,n,t){return(n=d(n))in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach(function(n){i(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function a(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var e,n,t="function"==typeof Symbol?Symbol:{},r=t.iterator||"@@iterator",i=t.toStringTag||"@@toStringTag";function o(t,r,i,o){var a=r&&r.prototype instanceof l?r:l,u=Object.create(a.prototype);return c(u,"_invoke",function(t,r,i){var o,a,c,l=0,u=i||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(n,t){return o=n,a=0,c=e,f.n=t,s}};function p(t,r){for(a=t,c=r,n=0;!d&&l&&!i&&n<u.length;n++){var i,o=u[n],p=f.p,h=o[2];t>3?(i=h===r)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=e):o[0]<=p&&((i=t<2&&p<o[1])?(a=0,f.v=r,f.n=o[1]):p<h&&(i=t<3||o[0]>r||r>h)&&(o[4]=t,o[5]=r,f.n=h,a=0))}if(i||t>1)return s;throw d=!0,r}return function(i,u,h){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&p(u,h),a=u,c=h;(n=a<2?e:c)||!d;){o||(a?a<3?(a>1&&(f.n=-1),p(a,c)):f.n=c:f.v=c);try{if(l=2,o){if(a||(i="next"),n=o[i]){if(!(n=n.call(o,c)))throw TypeError("iterator result is not an object");if(!n.done)return n;c=n.value,a<2&&(a=0)}else 1===a&&(n=o.return)&&n.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=e}else if((n=(d=f.n<0)?c:t.call(r,f))!==s)break}catch(n){o=e,a=1,c=n}finally{l=1}}return{value:n,done:d}}}(t,i,o),!0),u}var s={};function l(){}function u(){}function d(){}n=Object.getPrototypeOf;var f=[][r]?n(n([][r]())):(c(n={},r,function(){return this}),n),p=d.prototype=l.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=d,c(p,"constructor",d),c(d,"constructor",u),u.displayName="GeneratorFunction",c(d,i,"GeneratorFunction"),c(p),c(p,i,"Generator"),c(p,r,function(){return this}),c(p,"toString",function(){return"[object Generator]"}),(a=function(){return{w:o,m:h}})()}function c(e,n,t,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}c=function(e,n,t,r){function o(n,t){c(e,n,function(e){return this._invoke(n,t,e)})}n?i?i(e,n,{value:t,enumerable:!r,configurable:!r,writable:!r}):e[n]=t:(o("next",0),o("throw",1),o("return",2))},c(e,n,t,r)}function l(e){if(null!=e){var n=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],t=0;if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&t>=e.length&&(e=void 0),{value:e&&e[t++],done:!e}}}}throw new TypeError(typeof e+" is not iterable")}function u(n,t){return function(e){if(Array.isArray(e))return e}(n)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,i,o,s,a=[],c=!0,l=!1;try{if(o=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=o.call(t)).done)&&(a.push(r.value),a.length!==n);c=!0);}catch(e){l=!0,i=e}finally{try{if(!c&&null!=t.return&&(s=t.return(),Object(s)!==s))return}finally{if(l)throw i}}return a}}(n,t)||function(n,t){if(n){if("string"==typeof n)return e(n,t);var r={}.toString.call(n).slice(8,-1);return"Object"===r&&n.constructor&&(r=n.constructor.name),"Map"===r||"Set"===r?Array.from(n):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(n,t):void 0}}
/**
   * SunuID SDK - Package d'int√©gration pour partenaires
   * 
   * @version 1.0.0
   * @author SunuID Team
   * @license MIT
   */(n,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,n||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}!function(e,n){var i,o,c={apiUrl:(null===(n=e.SunuIDConfig)||void 0===n?void 0:n.apiUrl)||"https://api.sunuid.fayma.sn",clientId:null,secretId:null,type:2,partnerName:null,theme:"light",language:"fr",autoRefresh:!1,refreshInterval:3e4,autoInit:!1,onSuccess:null,onError:null,onStatusUpdate:null,onExpired:null,enableSecurityLogs:!0,validateInputs:!0,maxRetries:3,requestTimeout:1e4,secureInit:!1,secureInitUrl:null!==(i=e.SunuIDConfig)&&void 0!==i&&null!==(i=i.apiUrl)&&void 0!==i&&i.includes("api.sunuid.fayma.sn")?"https://api.sunuid.fayma.sn/secure-init.php":(null===(o=e.SunuIDConfig)||void 0===o||null===(o=o.apiUrl)||void 0===o?void 0:o.replace("/api",""))+"/secure-init.php"||"https://api.sunuid.fayma.sn/secure-init.php",token:null,forceRemoteServer:!0,useLocalFallback:!1,redirectAfterSuccess:null,verifySignature:!1,tokenMaxAge:300,onAuthenticationSuccess:null,onAuthenticationError:null,state:null},d=function(){return n=function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=s(s({},c),n),this.qrCode=null,this.refreshTimer=null,this.isInitialized=!1,this.socket=null,this.initPromise=null,console.log("üîß SDK SunuID cr√©√© - Appelez init() manuellement")},i=[{key:"init",value:(q=t(a().m(function e(){return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.isInitialized){e.n=1;break}return console.log("‚ö†Ô∏è SDK d√©j√† initialis√©, ignor√©"),e.a(2);case 1:if(!this.initPromise){e.n=2;break}return console.log("‚ö†Ô∏è Initialisation d√©j√† en cours, attente..."),e.a(2,this.initPromise);case 2:if(!this._initInProgress){e.n=3;break}return console.log("‚ö†Ô∏è Initialisation en cours, ignor√©"),e.a(2);case 3:return this._initInProgress=!0,this.initPromise=this._doInit(),e.p=4,e.n=5,this.initPromise;case 5:return e.p=5,this._initInProgress=!1,e.f(5);case 6:return e.a(2,this.initPromise)}},e,this,[[4,,5,6]])})),function(){return q.apply(this,arguments)})},{key:"_doInit",value:(D=t(a().m(function e(){var n;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!this.handleCallback()){e.n=1;break}return console.log("‚úÖ Callback trait√©, initialisation termin√©e"),e.a(2);case 1:if(!this.config.secureInit){e.n=3;break}return e.n=2,this.secureInit();case 2:e.n=4;break;case 3:this.config.validateInputs&&this.validateSecurityParams();case 4:return this.logSecurityEvent("SDK_INIT_START",{apiUrl:this.config.apiUrl,type:this.config.type,secureInit:this.config.secureInit}),e.n=5,this.fetchPartnerInfo();case 5:this.obfuscateCredentials(),this.isInitialized=!0,console.log("SunuID SDK initialis√© avec succ√®s"),console.log("üìã Configuration SDK:",{apiUrl:this.config.apiUrl,type:this.config.type,partnerName:this.config.partnerName,clientId:this.config.clientId?"***"+this.config.clientId.slice(-4):"null",secretId:this.config.secretId?"***"+this.config.secretId.slice(-4):"null",secureInit:this.config.secureInit,theme:this.config.theme}),this.logSecurityEvent("SDK_INIT_SUCCESS"),this.initWebSocket(),e.n=7;break;case 6:throw e.p=6,n=e.v,this.logSecurityEvent("SDK_INIT_ERROR",{error:n.message}),n;case 7:return e.a(2)}},e,this,[[0,6]])})),function(){return D.apply(this,arguments)})},{key:"secureInit",value:(T=t(a().m(function e(){var n,t,r,i,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,this.logSecurityEvent("SECURE_INIT_START"),n={type:this.config.type,partnerName:this.config.partnerName,theme:this.config.theme},e.n=1,fetch(this.config.secureInitUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(n)});case 1:if((t=e.v).ok){e.n=2;break}throw new Error("Erreur HTTP: ".concat(t.status));case 2:return e.n=3,t.json();case 3:if(r=e.v,console.log("üìã R√©ponse initialisation s√©curis√©e:",r),r.success){e.n=4;break}throw new Error(r.error||"Erreur lors de l'initialisation s√©curis√©e");case 4:if(this.config.token=r.data.token,this.config.apiUrl=r.data.api_url,!(i=this.decodeSecureToken(r.data.token))){e.n=5;break}this.config.clientId=i.client_id,this.config.secretId=i.secret_id,e.n=6;break;case 5:throw new Error("Impossible de d√©coder le token s√©curis√©");case 6:this.config.expiresIn=r.data.expires_in,this.config.maxRequests=r.data.max_requests,this.config.requestCount=0,this.logSecurityEvent("SECURE_INIT_SUCCESS",{expiresIn:r.data.expires_in,maxRequests:r.data.max_requests}),console.log("‚úÖ Initialisation s√©curis√©e r√©ussie"),e.n=8;break;case 7:throw e.p=7,o=e.v,this.logSecurityEvent("SECURE_INIT_ERROR",{error:o.message}),new Error("√âchec de l'initialisation s√©curis√©e: ".concat(o.message));case 8:return e.a(2)}},e,this,[[0,7]])})),function(){return T.apply(this,arguments)})},{key:"decodeSecureToken",value:function(e){try{var n=e.split(".");if(2!==n.length)return console.error("‚ùå Format de token invalide"),null;var t=u(n,2),r=t[0],i=(t[1],atob(r)),o=JSON.parse(i);return o.exp&&o.exp<Date.now()/1e3?(console.error("‚ùå Token expir√©"),null):(console.log("‚úÖ Token d√©cod√© avec succ√®s"),o)}catch(e){return console.error("‚ùå Erreur d√©codage token:",e),null}}},{key:"initWebSocket",value:function(){var e=this;try{if("undefined"==typeof io)return console.warn("‚ö†Ô∏è Socket.IO non disponible, WebSocket sera initialis√© plus tard"),void setTimeout(function(){return e.initWebSocket()},1e3);var n=this.getClientIP();this.socket?console.log("üåê WebSocket d√©j√† connect√©"):(console.log("üåê Initialisation Socket.IO..."),this.socket=io("wss://samasocket.fayma.sn:9443",{query:{token:this.config.clientId,type:"web",userId:this.config.clientId,username:n},transports:["websocket","polling"]}),this.socket.on("connect",function(){console.log("üåê WebSocket connect√© avec succ√®s"),console.log("üìä Socket ID:",e.socket.id),e.socket.connected=!0}),this.socket.on("disconnect",function(n){console.log("‚ùå WebSocket d√©connect√©:",n),e.socket.connected=!1}),this.socket.on("connect_error",function(n){console.error("‚ùå Erreur connexion WebSocket:",n),e.socket.connected=!1}),this.socket.on("qr_status_update",function(n){console.log("üì± Mise √† jour statut QR re√ßue:",n),e.handleQRStatusUpdate(n)}),this.socket.on("qr_scan_success",function(n){console.log("‚úÖ Scan QR r√©ussi re√ßu:",n),e.handleQRScanSuccess(n)}),this.socket.on("qr_expired",function(n){console.log("‚è∞ QR expir√© re√ßu:",n),e.handleQRExpired(n)}),this.socket.on("qr_scan_initiated",function(n){console.log("üîç QR Scan Initiated re√ßu:",n),e.showQRLoader()}),this.socket.on("message",function(n){console.log("üì® Message socket re√ßu:",n),n&&"qr_scan_initiated"===n.type&&(console.log("üîç QR Scan Initiated d√©tect√© dans message:",n),e.showQRLoader())}),this.socket.onAny=this.socket.onAny||function(e,n){console.log("üåê Socket Event [".concat(e,"]:"),n)},this.socket.onAny(function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];console.log("üåê Socket Event [".concat(e,"]:"),t)}))}catch(e){console.error("‚ùå Erreur initialisation WebSocket:",e)}}},{key:"getClientIP",value:function(){return"127.0.0.1"}},{key:"getTypeName",value:function(e){switch(e){case 1:return"KYC";case 2:return"AUTH";case 3:return"SIGNATURE";default:return"TYPE-".concat(e)}}},{key:"validateSecurityParams",value:function(){var e=[];if(this.config.clientId&&"string"==typeof this.config.clientId?this.config.clientId.length<10&&e.push("clientId trop court"):e.push("clientId invalide ou manquant"),this.config.secretId&&"string"==typeof this.config.secretId?this.config.secretId.length<32&&e.push("secretId trop court (minimum 32 caract√®res)"):e.push("secretId invalide ou manquant"),this.config.apiUrl&&this.isValidUrl(this.config.apiUrl)||e.push("apiUrl invalide"),[1,2,3].includes(this.config.type)||e.push("type invalide (doit √™tre 1, 2 ou 3)"),e.length>0)throw this.logSecurityEvent("VALIDATION_ERROR",{errors:e}),new Error("Param√®tres de s√©curit√© invalides: ".concat(e.join(", ")));this.logSecurityEvent("VALIDATION_SUCCESS")}},{key:"isValidUrl",value:function(e){try{var n=new URL(e);return"https:"===n.protocol||"http:"===n.protocol}catch(e){return!1}}},{key:"logSecurityEvent",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.config.enableSecurityLogs){var r={timestamp:(new Date).toISOString(),event:n,data:t,userAgent:navigator.userAgent,url:e.location.href};console.warn("üîí [SECURITY]",r),e.SunuIDSecurityLogs||(e.SunuIDSecurityLogs=[]),e.SunuIDSecurityLogs.push(r)}}},{key:"obfuscateCredentials",value:function(){this.config.originalClientId=this.config.clientId,this.config.originalSecretId=this.config.secretId,this.config.clientId&&(this.config.clientIdDisplay=this.config.clientId.replace(/(.{3}).*(.{3})/,"$1***$2")),this.config.secretId&&(this.config.secretIdDisplay=this.config.secretId.replace(/(.{4}).*(.{4})/,"$1***$2"))}},{key:"sanitizeInput",value:function(e){return"string"!=typeof e?e:e.replace(/[<>]/g,"").replace(/javascript:/gi,"").trim()}},{key:"handleQRStatusUpdate",value:function(e){console.log("üì± QR Status Update:",e),this.config.onStatusUpdate&&this.config.onStatusUpdate(e)}},{key:"handleQRScanSuccess",value:function(e){console.log("‚úÖ QR Scan Success re√ßu:",e);try{var n=this.extractAuthDataFromWebSocket(e);this.processAuthentication(n),this.showSuccessMessage(n),this.config.onSuccess&&this.config.onSuccess(n),console.log("‚úÖ Authentification WebSocket trait√©e avec succ√®s")}catch(n){console.error("‚ùå Erreur lors du traitement WebSocket:",n),this.config.onAuthenticationError&&this.config.onAuthenticationError(n,e)}}},{key:"handleQRExpired",value:function(e){console.log("‚è∞ QR Expired:",e),this.config.onExpired&&this.config.onExpired(e)}},{key:"emitWebSocketEvent",value:function(e,n){this.socket&&this.socket.connected?(this.socket.emit(e,n),console.log("üì§ √âv√©nement WebSocket √©mis: ".concat(e),n)):console.warn("‚ö†Ô∏è WebSocket non connect√©, impossible d'√©mettre l'√©v√©nement:",e)}},{key:"getWebSocketStatus",value:function(){return this.socket?this.socket.connected?"connected":"disconnected":"not_initialized"}},{key:"forceWebSocketInit",value:function(){"undefined"==typeof io||this.socket||(console.log("üîÑ For√ßage de l'initialisation WebSocket..."),this.initWebSocket())}},{key:"generateQR",value:(Q=t(a().m(function n(){var t,r,i,o,c,l,u,d,f,p,h,g=arguments;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:if(t=g.length>0&&void 0!==g[0]?g[0]:"sunuid-qr-container",r=g.length>1&&void 0!==g[1]?g[1]:{},!this.initPromise){n.n=2;break}return n.n=1,this.initPromise;case 1:this.initPromise=null;case 2:if(this.isInitialized){n.n=3;break}throw new Error("SunuID: SDK non initialis√©");case 3:return console.log("üéØ generateQR appel√© avec containerId:",t),console.log("üîç Attente connexions API et WebSocket..."),n.p=4,n.n=5,this.waitForConnections(5e3);case 5:i=n.v,console.log("‚úÖ Connexions pr√™tes:",i),n.n=7;break;case 6:throw n.p=6,p=n.v,console.error("‚ùå Erreur connexions:",p.message),new Error("Connexions non disponibles - Impossible de g√©n√©rer le QR code");case 7:return n.p=7,o=this.socket?this.socket.id:"timeout-socket-id",c=o,console.log("üìÑ Contenu QR pr√©par√©:",c),console.log("üîå Socket ID:",o),l=this.config.partnerName||"Partner_unknown",n.n=8,this.makeRequest("/qr-generate",s({type:this.config.type,data:c,label:"".concat(this.getTypeName(this.config.type)," ").concat(l)},r));case 8:if(!(u=n.v).success){n.n=11;break}if(console.log("üìã R√©ponse QR API compl√®te:",u),console.log("üìã Structure response.data:",u.data),(d=u.data.qrCodeUrl)&&d.startsWith("/")&&(d="".concat(this.config.apiUrl).concat(d)),d){n.n=10;break}if(console.warn("‚ö†Ô∏è qrCodeUrl non trouv√© dans la r√©ponse, recherche d'alternatives..."),!(d=u.data.qr_url||u.data.qrUrl||u.data.url||u.data.image_url||u.data.imageUrl)){n.n=9;break}console.log("‚úÖ URL QR trouv√©e dans un champ alternatif:",d),n.n=10;break;case 9:throw console.error("‚ùå Aucune URL QR trouv√©e dans la r√©ponse"),new Error("URL du QR code non trouv√©e dans la r√©ponse API");case 10:return this.currentQRUrl=d,console.log("‚úÖ QR code g√©n√©r√© par API principale:",d),console.log("üìÑ Contenu QR final:",c),console.log("üè∑Ô∏è Label QR:",u.data.label||"N/A"),console.log("üÜî Session ID:",u.data.sessionId||"N/A"),this.displayQRCode(t,d,this.config.type,r),this.startAutoRefresh(t,this.config.type,r),this.emitWebSocketEvent("qr_generated",{type:this.config.type,qrCodeUrl:d,socketId:o,qrContent:c,label:u.data.label,sessionId:u.data.sessionId,timestamp:Date.now()}),n.a(2,s(s({},u.data),{},{qrCodeUrl:d,qrContent:c,label:u.data.label,sessionId:u.data.sessionId}));case 11:throw new Error(u.message||"Erreur lors de la g√©n√©ration du QR code");case 12:n.n=14;break;case 13:throw n.p=13,h=n.v,console.error("Erreur API d√©tect√©e:",h.message),console.error("Stack trace complet:",h.stack),console.error("Configuration SDK:",{apiUrl:this.config.apiUrl,type:this.config.type,secureInit:this.config.secureInit,clientId:this.config.clientId?"***"+this.config.clientId.slice(-4):"null",secretId:this.config.secretId?"***"+this.config.secretId.slice(-4):"null"}),this.config.useLocalFallback?(console.log("üîç V√©rification fallback local..."),console.log("üîç Hostname:",e.location.hostname),console.log("üîç Protocol:",e.location.protocol),console.log("üîç URL compl√®te:",e.location.href),f="localhost"===e.location.hostname||"127.0.0.1"===e.location.hostname||"file:"===e.location.protocol,console.log("üîç Est local:",f),f?(console.log("üîÑ Tentative fallback vers service QR local..."),console.log("‚ùå Fallback local non impl√©ment√© - utilisation serveur distant uniquement")):console.log("‚ùå Pas en local, pas de fallback")):console.log("üîí Fallback local d√©sactiv√©, utilisation serveur distant uniquement"),console.log('Affichage du message "Service non disponible" pour type '+this.config.type),this.displayServiceUnavailable(t,this.config.type),new Error("Service non disponible");case 14:return n.a(2)}},n,this,[[7,13],[4,6]])})),function(){return Q.apply(this,arguments)})},{key:"generateCustomQR",value:(C=t(a().m(function e(n,t){var r,i,o,c,l=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=l.length>2&&void 0!==l[2]?l[2]:{},!this.initPromise){e.n=2;break}return e.n=1,this.initPromise;case 1:this.initPromise=null;case 2:if(this.isInitialized){e.n=3;break}throw new Error("SunuID: SDK non initialis√©");case 3:return e.p=3,e.n=4,this.makeRequest("/qr-generate",s({type:t},r));case 4:if(!(i=e.v).success){e.n=5;break}return o="".concat("https://sunuid.fayma.sn").concat(i.data.qrcode),this.displayQRCode(n,o,t,r),console.log("‚úÖ QR code personnalis√© g√©n√©r√© par API principale:",o),console.log("üìÑ Code de session:",i.data.code),console.log("üÜî Service ID:",i.data.service_id),this.startAutoRefresh(n,t,r),e.a(2,s(s({},i.data),{},{qrCodeUrl:o,sessionId:i.data.service_id}));case 5:throw new Error(i.message||"Erreur lors de la g√©n√©ration du QR code");case 6:e.n=8;break;case 7:throw e.p=7,c=e.v,console.error("Erreur API d√©tect√©e:",c.message),console.error("Stack trace complet:",c.stack),console.error("Configuration SDK (Custom):",{apiUrl:this.config.apiUrl,type:t,secureInit:this.config.secureInit,clientId:this.config.clientId?"***"+this.config.clientId.slice(-4):"null",secretId:this.config.secretId?"***"+this.config.secretId.slice(-4):"null"}),console.log('Affichage du message "Service non disponible" pour type '+t),this.displayServiceUnavailable(n,t),new Error("Service non disponible");case 8:return e.a(2)}},e,this,[[3,7]])})),function(e,n){return C.apply(this,arguments)})},{key:"generateAuthQR",value:(x=t(a().m(function e(n){var t,r=arguments;return a().w(function(e){for(;;)if(0===e.n)return t=r.length>1&&void 0!==r[1]?r[1]:{},e.a(2,this.generateQR(n,t))},e,this)})),function(e){return x.apply(this,arguments)})},{key:"generateKYCQR",value:(_=t(a().m(function e(n){var t,r,i=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=i.length>1&&void 0!==i[1]?i[1]:{},r=this.config.type,this.config.type=1,e.p=1,e.n=2,this.generateQR(n,t);case 2:return e.a(2,e.v);case 3:return e.p=3,this.config.type=r,e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])})),function(e){return _.apply(this,arguments)})},{key:"generateSignatureQR",value:(E=t(a().m(function e(n){var t,r,i=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return t=i.length>1&&void 0!==i[1]?i[1]:{},r=this.config.type,this.config.type=3,e.p=1,e.n=2,this.generateQR(n,t);case 2:return e.a(2,e.v);case 3:return e.p=3,this.config.type=r,e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])})),function(e){return E.apply(this,arguments)})},{key:"checkQRStatus",value:(R=t(a().m(function e(n){var t,r;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.isInitialized){e.n=1;break}throw new Error("SunuID: SDK non initialis√©");case 1:return e.p=1,e.n=2,this.makeRequest("/qr-status",{serviceId:n});case 2:if(!(t=e.v).success){e.n=3;break}return e.a(2,t.data);case 3:throw new Error(t.message||"Erreur lors de la v√©rification du statut");case 4:e.n=6;break;case 5:throw e.p=5,r=e.v,this.handleError(r),r;case 6:return e.a(2)}},e,this,[[1,5]])})),function(e){return R.apply(this,arguments)})},{key:"generateQRWithContent",value:(w=t(a().m(function n(t,r,i){var o,s,c,l=arguments;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:if(o=l.length>3&&void 0!==l[3]?l[3]:{},console.log("üé® G√©n√©ration QR avec contenu:",t),n.p=1,"localhost"!==e.location.hostname&&"127.0.0.1"!==e.location.hostname&&"file:"!==e.location.protocol){n.n=3;break}return console.log("üè† Utilisation service QR local..."),n.n=2,this.generateQRLocal(t,r,i,o);case 2:if(!(s=n.v)){n.n=3;break}return n.a(2,s);case 3:return console.log("üåê Utilisation service QR distant..."),n.n=4,this.generateQRRemote(t,r,i,o);case 4:return n.a(2,n.v);case 5:return n.p=5,c=n.v,console.error("‚ùå Erreur g√©n√©ration QR:",c),this.displayQRContent(r,t,i,o),n.a(2,null)}},n,this,[[1,5]])})),function(e,n,t){return w.apply(this,arguments)})},{key:"generateQRLocal",value:(I=t(a().m(function e(n,t,r){var i,o,s,c,l,u=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return i=u.length>3&&void 0!==u[3]?u[3]:{},e.p=1,e.n=2,fetch("http://localhost:8000/api/generate/text",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"text=".concat(encodeURIComponent(n),"&size=300")});case 2:if(!(o=e.v).ok){e.n=4;break}return e.n=3,o.json();case 3:return s=e.v,c="data:image/png;base64,".concat(s.qrcode),this.displayQRCode(t,c,r,i),e.a(2,c);case 4:e.n=6;break;case 5:e.p=5,l=e.v,console.log("‚ùå Service QR local non disponible:",l.message);case 6:return e.a(2,null)}},e,this,[[1,5]])})),function(e,n,t){return I.apply(this,arguments)})},{key:"generateQRRemote",value:(S=t(a().m(function e(n,t,r){var i,o,s,c,l,u=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return i=u.length>3&&void 0!==u[3]?u[3]:{},e.p=1,e.n=2,fetch("https://api.sunuid.fayma.sn/qr-generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:n,size:300,type:r})});case 2:if(!(o=e.v).ok){e.n=4;break}return e.n=3,o.json();case 3:return s=e.v,c="data:image/png;base64,".concat(s.qrcode),this.displayQRCode(t,c,r,i),e.a(2,c);case 4:e.n=6;break;case 5:e.p=5,l=e.v,console.error("‚ùå Erreur service QR distant:",l);case 6:return this.displayQRContent(t,n,r,i),e.a(2,null)}},e,this,[[1,5]])})),function(e,n,t){return S.apply(this,arguments)})},{key:"displayQRContent",value:function(e,n,t){var r=document.getElementById(e);if(!r)throw new Error("Conteneur avec l'ID \"".concat(e,'" non trouv√©'));var i=this.getTypeName(t);r.innerHTML='\n                <div class="sunuid-qr-code">\n                    <div class="sunuid-qr-header">\n                        <h3>'.concat(i,'</h3>\n                    </div>\n                    <div class="sunuid-qr-content" style="text-align: center; padding: 20px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; margin: 10px 0;">\n                        <p><strong>Contenu QR Code:</strong></p>\n                        <p style="font-family: monospace; font-size: 14px; word-break: break-all;">').concat(n,'</p>\n                    </div>\n                    <div class="sunuid-qr-instructions">\n                        <p>Contenu QR g√©n√©r√© avec le format: {type}-{code}-{socketid}</p>\n                    </div>\n                </div>\n            '),console.log("‚úÖ Contenu QR affich√©:",n)}},{key:"displayQRCode",value:function(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=document.getElementById(e);if(!i)throw new Error("Conteneur avec l'ID \"".concat(e,'" non trouv√©'));i.innerHTML="";var o=document.createElement("div");o.className="sunuid-qr-code";var s=this.getTypeName(t);o.innerHTML='\n                <div class="sunuid-qr-header">\n                    <h3>'.concat(1===t?"V√©rification KYC":2===t?"Authentification":3===t?"Signature":"Service Type "+t,'</h3>\n                </div>\n                <div class="sunuid-qr-image">\n                    <img src="').concat(n,'" alt="QR Code ').concat(s,'" style="max-width: 300px; border: 1px solid #ddd; border-radius: 5px;" />\n                </div>\n               \n            '),i.appendChild(o),this.applyTheme(r.theme||this.config.theme),console.log("‚úÖ QR code affich√©:",n)}},{key:"generateCustomQRCode",value:(k=t(a().m(function e(n,t){var r,i;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log("üé® D√©but g√©n√©ration QR personnalis√©..."),console.log("üìÑ Contenu:",n),console.log("üè∑Ô∏è Label:",t),(r=document.getElementById("sunuid-qr-container"))||(r=document.getElementById("qr-container")),r){e.n=1;break}return console.error("‚ùå QR container not found"),e.a(2);case 1:return console.log("‚úÖ QR container trouv√©"),r.innerHTML='<div style="text-align: center; padding: 20px;"><p>G√©n√©ration QR code...</p></div>',e.p=2,console.log("üé® Tentative g√©n√©ration via API principale..."),e.n=3,this.generateQRPHP(n,t,r);case 3:console.log("‚úÖ QR code g√©n√©r√© avec succ√®s"),e.n=5;break;case 4:e.p=4,i=e.v,console.error("‚ùå Erreur g√©n√©ration API:",i),console.log("‚ö†Ô∏è Affichage image par d√©faut"),this.displayDefaultQR(r,n,t);case 5:return e.a(2)}},e,this,[[2,4]])})),function(e,n){return k.apply(this,arguments)})},{key:"generateQRClientSide",value:(b=t(a().m(function e(n,t,r){var i,o,s=this;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.ensureQRCodeLibrary();case 1:if("undefined"!=typeof QRCode){e.n=2;break}throw new Error("QRCode library non disponible");case 2:return(i=document.createElement("canvas")).width=300,i.height=320,(o=i.getContext("2d")).fillStyle="#FFFFFF",o.fillRect(0,0,300,320),e.a(2,new Promise(function(e,a){QRCode.toCanvas(i,n,{width:280,margin:10,color:{dark:"#000000",light:"#FFFFFF"}},function(n){if(n)a(n);else{o.fillStyle="#333333",o.font="bold 14px Arial",o.textAlign="center",o.fillText(t,150,305);var c=i.toDataURL("image/png");s.currentQRUrl=c,r.innerHTML='\n                        <div style="text-align: center; padding: 20px;">\n                            <img src="'.concat(c,'" alt="QR Code" style="max-width: 300px; border: 2px solid #ddd; border-radius: 10px;">\n                        </div>\n                    '),s.showQRInstructions(r),e()}})}))}},e,this)})),function(e,n,t){return b.apply(this,arguments)})},{key:"generateQRPHP",value:(m=t(a().m(function e(n,t,r){var i,o,s,c,l,u;return a().w(function(e){for(;;)switch(e.n){case 0:return i=this.config.forceRemoteServer||this.config.apiUrl.includes("api.sunuid.fayma.sn")?"https://api.sunuid.fayma.sn/qr-generate":this.config.apiUrl.includes("localhost")||this.config.apiUrl.includes("127.0.0.1")?"http://localhost:8000/api/generate/text":this.config.apiUrl+"/qr-generate",console.log("üîó URL QR Generator:",i),i.includes("localhost:8000")?(s="application/x-www-form-urlencoded",o=new URLSearchParams({text:n,size:300,margin:10,foreground_color:"000000",background_color:"FFFFFF"})):(s="application/json",o=JSON.stringify({type:this.config.type,client_id:this.config.clientId,secret_id:this.config.secretId,content:n,label:t})),e.n=1,fetch(i,{method:"POST",headers:{"Content-Type":s,Accept:"application/json"},body:o});case 1:if((c=e.v).ok){e.n=2;break}throw new Error("Erreur HTTP: ".concat(c.status));case 2:return e.n=3,c.json();case 3:if((l=e.v).success){e.n=4;break}throw new Error("Erreur QR: ".concat(l.error));case 4:u=i.includes("localhost:8000")?l.data_uri:"".concat("https://sunuid.fayma.sn").concat(l.data.qrcode),this.currentQRUrl=u,r.innerHTML='\n                 <div style="text-align: center; padding: 20px;">\n                     <img src="'.concat(u,'" alt="QR Code" style="max-width: 300px; border: 2px solid #ddd; border-radius: 10px;">\n                 </div>\n             '),this.showQRInstructions(r);case 5:return e.a(2)}},e,this)})),function(e,n,t){return m.apply(this,arguments)})},{key:"displayDefaultQR",value:function(e,n,t){e.innerHTML='\n                <div style="text-align: center; padding: 20px; color: #666;">\n                    <div style="width: 300px; height: 300px; background: #f0f0f0; border: 2px solid #ddd; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">\n                        <div>\n                            <p style="font-size: 24px; margin: 0;">üì±</p>\n                            <p style="font-size: 14px; margin: 10px 0 0 0;">QR Code</p>\n                        </div>\n                    </div>\n                    <p style="margin-top: 10px; font-size: 12px;">'.concat(t,'</p>\n                    <p style="font-size: 10px; color: #999; margin-top: 5px;">Contenu: ').concat(n,"</p>\n                </div>\n            ")}},{key:"ensureQRCodeLibrary",value:(y=t(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:if("undefined"==typeof QRCode){e.n=1;break}return console.log("‚úÖ QRCode library d√©j√† disponible"),e.a(2,!0);case 1:return console.log("üì¶ Chargement QRCode library..."),e.a(2,new Promise(function(e,n){var t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/lib/browser.min.js",t.onload=function(){setTimeout(function(){"undefined"!=typeof QRCode?(console.log("‚úÖ QRCode library charg√©e"),e(!0)):(console.error("‚ùå QRCode non disponible apr√®s chargement"),n(new Error("QRCode library non disponible apr√®s chargement")))},200)},t.onerror=function(){console.error("‚ùå Erreur chargement QRCode library"),n(new Error("Erreur chargement QRCode library"))},document.head.appendChild(t)}))}},e)})),function(){return y.apply(this,arguments)})},{key:"showQRInstructions",value:function(e){var n=e.parentElement.querySelector(".sunuid-qr-instructions"),t=e.parentElement.querySelector(".sunuid-qr-status");n&&(n.style.display="block",n.classList.add("sunuid-qr-ready")),t&&(t.style.display="block",t.classList.add("sunuid-qr-ready"))}},{key:"addLogoToCenter",value:function(e,n,t,r,i){try{var o=new Image;o.onload=function(){var i=40,s=n+(r-i)/2,a=t+(r-i)/2;e.fillStyle="white",e.fillRect(s-2,a-2,44,44),e.drawImage(o,s,a,i,i)},o.src="src/logoqr.png"}catch(e){console.warn("Logo non disponible:",e)}}},{key:"displayFallbackImage",value:function(){console.log("‚ö†Ô∏è Affichage de l'image de fallback");var e=document.getElementById("sunuid-qr-container");e&&(e.innerHTML='\n                    <div style="text-align: center; padding: 20px; color: #666;">\n                        <p>‚ö†Ô∏è G√©n√©ration QR personnalis√© non disponible</p>\n                        <p>Utilisation de l\'image par d√©faut</p>\n                        <p><strong>Debug:</strong> QRCode disponible: '.concat("undefined"!=typeof QRCode,"</p>\n                        <p><strong>Debug:</strong> Container trouv√©: ").concat(null!==e,"</p>\n                    </div>\n                "))}},{key:"displayServiceUnavailable",value:function(e,n){console.log("displayServiceUnavailable appel√©e pour ".concat(e,", type: ").concat(n));var t=document.getElementById(e);t?t.innerHTML='\n                <div class="sunuid-service-unavailable" style="\n                    text-align: center;\n                    padding: 40px 20px;\n                    background: #f8f9fa;\n                    border: 2px dashed #dee2e6;\n                    border-radius: 10px;\n                    color: #6c757d;\n                    font-family: Arial, sans-serif;\n                ">\n                    <div style="font-size: 48px; margin-bottom: 20px;">‚ö†Ô∏è</div>\n                    <h3 style="margin: 0 0 10px 0; color: #495057;">Service Non Disponible</h3>\n                    <p style="margin: 0; font-size: 14px;">\n                        Le service d\'authentification est temporairement indisponible.<br>\n                        Veuillez r√©essayer plus tard.\n                    </p>\n                    <div style="margin-top: 20px; font-size: 12px; color: #adb5bd;">\n                        Type: '.concat(String(n).toUpperCase(),"\n                    </div>\n                </div>\n            "):console.error("Container ".concat(e," non trouv√©"))}},{key:"refreshQR",value:(v=t(a().m(function e(n){var t,r,i,o,s=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=s.length>1&&void 0!==s[1]?s[1]:{},e.p=1,!this.currentQRUrl){e.n=3;break}return console.log("üîÑ V√©rification du statut du QR code existant..."),e.n=2,this.generateQR(n,t);case 2:return r=e.v,e.a(2,r);case 3:return console.log("üîÑ Pas de QR code existant, g√©n√©ration d'un nouveau..."),e.n=4,this.generateQR(n,t);case 4:return i=e.v,e.a(2,i);case 5:e.n=7;break;case 6:throw e.p=6,o=e.v,console.error("Erreur lors du rafra√Æchissement:",o.message),this.displayServiceUnavailable(n,this.config.type),o;case 7:return e.a(2)}},e,this,[[1,6]])})),function(e){return v.apply(this,arguments)})},{key:"startAutoRefresh",value:function(e,n,r){var i=this;this.config.autoRefresh&&(this.refreshTimer&&(clearInterval(this.refreshTimer),console.log("üîÑ Timer de rafra√Æchissement pr√©c√©dent arr√™t√©")),this.refreshTimer=setInterval(t(a().m(function t(){var o;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,console.log("üîÑ Rafra√Æchissement automatique du QR code..."),t.n=1,i.refreshQR(e,n,r);case 1:t.n=3;break;case 2:t.p=2,o=t.v,console.warn("Erreur lors du rafra√Æchissement automatique:",o);case 3:return t.a(2)}},t,null,[[0,2]])})),this.config.refreshInterval),console.log("üîÑ Timer de rafra√Æchissement d√©marr√© (".concat(this.config.refreshInterval,"ms)")))}},{key:"makeRequest",value:(g=t(a().m(function n(t,r){var i,o,s,c,u,d,f,p,h,g=this;return a().w(function(n){for(;;)switch(n.n){case 0:if(this.isInitialized){n.n=1;break}throw this.logSecurityEvent("REQUEST_BEFORE_INIT",{endpoint:t}),new Error("SDK non initialis√©");case 1:if(!this.config.secureInit){n.n=2;break}if(this.config.requestCount++,!(this.config.requestCount>this.config.maxRequests)){n.n=2;break}throw this.logSecurityEvent("API_REQUEST_LIMIT_EXCEEDED",{requestCount:this.config.requestCount,maxRequests:this.config.maxRequests}),new Error("Limite de requ√™tes d√©pass√©e");case 2:s=this.sanitizeRequestData(r),console.log("üîç Debug makeRequest - endpoint:",t),console.log("üîç Debug makeRequest - apiUrl:",this.config.apiUrl),console.log("üîç Debug makeRequest - url:","".concat(this.config.apiUrl).concat(t)),console.log("üîç Debug makeRequest - data:",JSON.stringify(s,null,2)),console.log("üîç Debug makeRequest - secureInit:",this.config.secureInit),console.log("üîç Debug makeRequest - isInitialized:",this.isInitialized),c=(null===(i=e.SunuIDConfig)||void 0===i||null===(i=i.endpoints)||void 0===i?void 0:i[t.replace("/","")])||t,u="".concat(this.config.apiUrl).concat(c),console.log("üîç URL finale construite:",u),console.log("üîç EndpointPath:",c),console.log("üîç SunuIDConfig endpoints:",JSON.stringify(null===(o=e.SunuIDConfig)||void 0===o?void 0:o.endpoints)),this.logSecurityEvent("API_REQUEST_START",{endpoint:c,url:u,dataKeys:Object.keys(s),secureInit:this.config.secureInit}),d=0,f=this.config.maxRetries,p=a().m(function e(){var n,t,r,i,o,l,p,h;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,n=new AbortController,t=setTimeout(function(){return n.abort()},g.config.requestTimeout),r={"Content-Type":"application/json"},e.n=1,fetch(u,{method:"POST",headers:r,body:JSON.stringify(s),signal:n.signal});case 1:if(i=e.v,clearTimeout(t),i.ok){e.n=3;break}return e.n=2,i.text();case 2:o=e.v;try{l=JSON.parse(o)}catch(e){l={message:o}}throw g.logSecurityEvent("API_REQUEST_ERROR",{status:i.status,statusText:i.statusText,error:l.message}),new Error(l.message||"Erreur HTTP: ".concat(i.status));case 3:return e.n=4,i.json();case 4:return p=e.v,g.logSecurityEvent("API_REQUEST_SUCCESS",{endpoint:c,responseKeys:Object.keys(p)}),e.a(2,{v:p});case 5:if(e.p=5,h=e.v,d++,"AbortError"!==h.name){e.n=7;break}if(g.logSecurityEvent("API_REQUEST_TIMEOUT",{retryCount:d}),!(d>f)){e.n=6;break}throw new Error("Timeout de la requ√™te API");case 6:return e.a(2,0);case 7:if(!(d>f)){e.n=8;break}throw g.logSecurityEvent("API_REQUEST_MAX_RETRIES",{retryCount:d,error:h.message}),h;case 8:return e.n=9,new Promise(function(e){return setTimeout(e,1e3*d)});case 9:return e.a(2)}},e,null,[[0,5]])});case 3:if(!(d<=f)){n.n=7;break}return n.d(l(p()),4);case 4:if(0!==(h=n.v)){n.n=5;break}return n.a(3,3);case 5:if(!h){n.n=6;break}return n.a(2,h.v);case 6:n.n=3;break;case 7:return n.a(2)}},n,this)})),function(e,n){return g.apply(this,arguments)})},{key:"sanitizeRequestData",value:function(e){for(var n={},t=0,r=Object.entries(e);t<r.length;t++){var i=u(r[t],2),o=i[0],s=i[1];"string"==typeof s?n[o]=this.sanitizeInput(s):"object"===f(s)&&null!==s?n[o]=this.sanitizeRequestData(s):n[o]=s}return n.client_id=this.config.originalClientId||this.config.clientId,n.secret_id=this.config.originalSecretId||this.config.secretId,console.log("üîç Credentials dans sanitizeRequestData - clientId:",this.config.clientId),console.log("üîç Credentials dans sanitizeRequestData - secretId:",this.config.secretId?"***"+this.config.secretId.slice(-4):"null"),console.log("üîç Credentials dans sanitizeRequestData - sanitizedClientId:",n.client_id),console.log("üîç Credentials dans sanitizeRequestData - sanitizedSecretId:",n.secret_id?"***"+n.secret_id.slice(-4):"null"),console.log("üîç Credentials dans sanitizeRequestData - data complet:",JSON.stringify(n,null,2)),n}},{key:"generateRequestId",value:function(){return"req_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}},{key:"generateSessionCode",value:function(){var e=Date.now(),n=Math.random().toString(36).substr(2,9),t="".concat(e,"_").concat(n);return btoa(t)}},{key:"fetchPartnerInfo",value:(h=t(a().m(function e(){var n,t,r,i;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.makeRequest("/debug",{type:this.config.type,client_id:this.config.clientId,secret_id:this.config.secretId});case 1:n=e.v,console.log("üìã R√©ponse debug API:",n),n.success&&n.data?(t=n.data,r=null,t.partner_id?r=t.partner_id:t.authentication&&t.authentication.auth_test&&t.authentication.auth_test.partner_id?r=t.authentication.auth_test.partner_id:t.auth_test&&t.auth_test.partner_id&&(r=t.auth_test.partner_id),r?(this.config.partnerId=r,t.service_id?this.config.serviceId=t.service_id:this.config.serviceId=r,this.config.partnerName=21===r?"Fayma":"Partner_".concat(r),console.log("‚úÖ Informations partenaire r√©cup√©r√©es:",{partnerName:this.config.partnerName,partnerId:this.config.partnerId,serviceId:this.config.serviceId})):(console.warn("‚ö†Ô∏è Partner ID non trouv√© dans la r√©ponse, utilisation du partner_id par d√©faut"),this.config.partnerName="Partner_".concat(this.config.partnerId||"unknown"))):(console.warn("‚ö†Ô∏è Structure de r√©ponse invalide, utilisation du partner_id par d√©faut"),this.config.partnerName="Partner_".concat(this.config.partnerId||"unknown")),e.n=3;break;case 2:e.p=2,i=e.v,console.warn("‚ö†Ô∏è Erreur lors de la r√©cup√©ration des informations du partenaire:",i.message),this.config.partnerName="Partner_unknown";case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return h.apply(this,arguments)})},{key:"applyTheme",value:function(e){var n=document.querySelector(".sunuid-qr-code");n&&(n.className="sunuid-qr-code sunuid-theme-".concat(e))}},{key:"handleError",value:function(e){console.error("SunuID SDK Error:",e),this.config.onError&&this.config.onError(e)}},{key:"checkConnections",value:(p=t(a().m(function e(){var n,t,r,i;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return n={api:!1,websocket:!1,ready:!1},e.p=1,e.n=2,fetch(this.config.apiUrl+"/debug",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:this.config.type,client_id:this.config.clientId,secret_id:this.config.secretId})});case 2:if(!(t=e.v).ok){e.n=4;break}return e.n=3,t.json();case 3:r=e.v,n.api=!0===r.success,console.log("üîç API Status:",n.api?"accessible":"inaccessible"),e.n=5;break;case 4:n.api=!1,console.log("üîç API Status: HTTP",t.status);case 5:e.n=7;break;case 6:e.p=6,i=e.v,console.log("üîç Test API √©chou√©:",i.message),n.api=!1;case 7:return n.websocket=this.socket&&this.socket.connected,n.ready=n.api,e.a(2,n)}},e,this,[[1,6]])})),function(){return p.apply(this,arguments)})},{key:"waitForConnections",value:(d=t(a().m(function e(){var n,t,r,i=arguments;return a().w(function(e){for(;;)switch(e.n){case 0:n=i.length>0&&void 0!==i[0]?i[0]:5e3,t=Date.now();case 1:if(!(Date.now()-t<n)){e.n=5;break}return e.n=2,this.checkConnections();case 2:if(!(r=e.v).ready){e.n=3;break}return console.log("‚úÖ Connexions pr√™tes"),e.a(2,r);case 3:return console.log("‚è≥ Attente connexions...",r),e.n=4,new Promise(function(e){return setTimeout(e,1e3)});case 4:e.n=1;break;case 5:throw new Error("Timeout connexions - Impossible de g√©n√©rer le QR code");case 6:return e.a(2)}},e,this)})),function(){return d.apply(this,arguments)})},{key:"getQRCode",value:function(){return this.currentQRUrl?this.currentQRUrl:null}},{key:"destroy",value:function(){this.stopAutoRefresh(),this.socket&&(this.socket.disconnect(),this.socket=null,console.log("üåê WebSocket d√©connect√©")),this.isInitialized=!1,this.logSecurityEvent("SDK_DESTROY"),console.log("SunuID SDK d√©truit")}},{key:"stopAutoRefresh",value:function(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null,console.log("üîÑ Timer de rafra√Æchissement arr√™t√©"))}},{key:"getSecurityLogs",value:function(){return e.SunuIDSecurityLogs||[]}},{key:"clearSecurityLogs",value:function(){e.SunuIDSecurityLogs=[],this.logSecurityEvent("SECURITY_LOGS_CLEARED")}},{key:"showQRLoader",value:function(){console.log("üîÑ Affichage du loader - Scan QR initi√©");for(var e=null,n=0,t=["qr-area","qr-container","sunuid-qr-container"];n<t.length;n++){var r=t[n];if(e=document.getElementById(r))break}e?(e.innerHTML='\n                <div style="\n                    text-align: center;\n                    padding: 40px 20px;\n                    background: #f8f9fa;\n                    border: 2px solid #007bff;\n                    border-radius: 10px;\n                    color: #007bff;\n                    font-family: Arial, sans-serif;\n                ">\n                    <div style="\n                        width: 60px;\n                        height: 60px;\n                        border: 4px solid #e3f2fd;\n                        border-top: 4px solid #007bff;\n                        border-radius: 50%;\n                        animation: spin 1s linear infinite;\n                        margin: 0 auto 20px auto;\n                    "></div>\n                    <h3 style="margin: 0 0 10px 0; color: #007bff;">üîç Scan en cours...</h3>\n                    <p style="margin: 0; font-size: 14px;">\n                        Veuillez patienter pendant la v√©rification de votre identit√©.\n                    </p>\n                    <div style="margin-top: 15px; font-size: 12px; color: #6c757d;">\n                        ‚è±Ô∏è Traitement en cours...\n                    </div>\n                </div>\n                <style>\n                    @keyframes spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                </style>\n            ',console.log("‚úÖ Loader affich√© avec succ√®s")):console.warn("‚ö†Ô∏è Conteneur QR non trouv√© pour afficher le loader")}},{key:"extractAuthDataFromWebSocket",value:function(e){if(console.log("üîç Extraction des donn√©es d'authentification du WebSocket:",e),e.token&&e.session_id)return console.log("‚úÖ Donn√©es d√©j√† au bon format (callback)"),e;if(e.responseData){console.log("‚úÖ Format WebSocket d√©tect√©, extraction de responseData"),console.log("üîç Contenu complet de responseData:",e.responseData),console.log("üîç Cl√©s disponibles dans responseData:",Object.keys(e.responseData));var n=e.responseData,t=n.data||n;console.log("üîç Donn√©es d'authentification dans data:",t),console.log("üîç Cl√©s disponibles dans data:",Object.keys(t));var r={token:t.token||t.auth_token||t.jwt_token,session_id:t.session_id||t.sessionId||t.session,user_id:t.user_id||t.userId||t.user,partner_id:t.partner_id||t.partnerId||t.partner,type:t.type,timestamp:t.timestamp||n.timestamp||e.timestamp,signature:t.signature,user_info:t.user_info||t.userInfo||t.user_data,redirect_url:t.redirect_url||t.redirectUrl||t.redirect};return console.log("üìã Donn√©es d'authentification extraites:",r),r}return console.log("‚ö†Ô∏è Format non reconnu, tentative d'extraction directe"),{token:e.token||e.auth_token,session_id:e.session_id||e.sessionId,user_id:e.user_id||e.userId,partner_id:e.partner_id||e.partnerId,type:e.type,timestamp:e.timestamp,signature:e.signature,user_info:e.user_info||e.userInfo,redirect_url:e.redirect_url||e.redirectUrl}}},{key:"showSuccessMessage",value:function(e){console.log("‚úÖ Affichage du message de succ√®s");for(var n=null,t=0,r=["qr-area","qr-container","sunuid-qr-container"];t<r.length;t++){var i=r[t];if(n=document.getElementById(i))break}if(n){var o=e.user_info||{},s=o.name||o.username||"Utilisateur",a=o.email||"";n.innerHTML='\n                <div style="\n                    text-align: center;\n                    padding: 40px 20px;\n                    background: #d4edda;\n                    border: 2px solid #28a745;\n                    border-radius: 10px;\n                    color: #155724;\n                    font-family: Arial, sans-serif;\n                ">\n                    <div style="\n                        width: 60px;\n                        height: 60px;\n                        background: #28a745;\n                        border-radius: 50%;\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        margin: 0 auto 20px auto;\n                        font-size: 30px;\n                        color: white;\n                    ">‚úÖ</div>\n                    <h3 style="margin: 0 0 10px 0; color: #155724;">üéâ Authentification r√©ussie !</h3>\n                    <p style="margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">\n                        Bienvenue, '.concat(s," !\n                    </p>\n                    ").concat(a?'<p style="margin: 0 0 15px 0; font-size: 14px; color: #6c757d;">'.concat(a,"</p>"):"",'\n                    <p style="margin: 0; font-size: 14px;">\n                        Votre identit√© a √©t√© v√©rifi√©e avec succ√®s.\n                    </p>\n                    <div style="margin-top: 20px; font-size: 12px; color: #6c757d;">\n                        üîÑ Redirection en cours...\n                    </div>\n                </div>\n            '),console.log("‚úÖ Message de succ√®s affich√©")}else console.warn("‚ö†Ô∏è Conteneur QR non trouv√© pour afficher le message de succ√®s")}},{key:"handleCallback",value:function(){var n=new URLSearchParams(e.location.search);if(n.has("token")&&n.has("session_id")){console.log("üîó Callback SunuID d√©tect√©");var t={token:n.get("token"),state:n.get("state"),session_id:n.get("session_id"),user_id:n.get("user_id"),partner_id:n.get("partner_id"),type:n.get("type"),timestamp:n.get("timestamp"),signature:n.get("signature")};return console.log("üìã Donn√©es callback:",t),this.validateCallback(t),this.processAuthentication(t),!0}return!1}},{key:"validateCallback",value:function(e){if(console.log("üîí Validation du callback..."),e.state&&e.state!==this.config.state)throw console.error("‚ùå √âtat de s√©curit√© invalide"),new Error("√âtat de s√©curit√© invalide");if(e.signature&&this.config.verifySignature&&!this.verifySignature(e))throw console.error("‚ùå Signature invalide"),new Error("Signature invalide");if(e.timestamp&&this.isExpired(e.timestamp))throw console.error("‚ùå Token expir√©"),new Error("Token expir√©");console.log("‚úÖ Callback valid√© avec succ√®s")}},{key:"processAuthentication",value:function(e){console.log("üîê Traitement de l'authentification...");try{var n=this.decodeJWT(e.token),t={user_id:n.user_id||e.user_id,session_id:n.session_id||e.session_id,partner_id:n.partner_id||e.partner_id,type:n.type||e.type,iat:n.iat,exp:n.exp};console.log("üë§ Donn√©es utilisateur:",t),this.emitWebSocketEvent("authentication_success",{userData:t,callbackData:e,timestamp:Date.now()}),this.config.onAuthenticationSuccess&&this.config.onAuthenticationSuccess(t,e),this.config.redirectAfterSuccess&&this.redirectAfterSuccess(t),console.log("‚úÖ Authentification trait√©e avec succ√®s")}catch(n){throw console.error("‚ùå Erreur lors du traitement:",n),this.config.onAuthenticationError&&this.config.onAuthenticationError(n,e),n}}},{key:"decodeJWT",value:function(e){try{var n=e.split(".");if(3!==n.length)throw new Error("Format JWT invalide");var t=n[1];return JSON.parse(atob(t))}catch(e){throw console.error("‚ùå Erreur d√©codage JWT:",e),new Error("Token JWT invalide")}}},{key:"verifySignature",value:function(e){var n=this.generateSignature(e);return e.signature===n}},{key:"generateSignature",value:function(e){var n="".concat(e.token,".").concat(e.state,".").concat(e.session_id,".").concat(e.timestamp);return btoa(n).slice(0,12)}},{key:"isExpired",value:function(e){return Math.floor(Date.now()/1e3)-parseInt(e)>(this.config.tokenMaxAge||300)}},{key:"redirectAfterSuccess",value:function(n){var t=this.config.redirectAfterSuccess;t=t.replace("{user_id}",n.user_id).replace("{session_id}",n.session_id).replace("{partner_id}",n.partner_id).replace("{type}",n.type),console.log("üîÑ Redirection vers:",t),setTimeout(function(){e.location.href=t},100)}},{key:"generateState",value:function(){var e="sunuid_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);return this.config.state=e,e}}],i&&r(n.prototype,i),o&&r(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,i,o,d,p,h,g,v,y,m,b,k,S,I,w,R,E,_,x,C,Q,T,D,q}();e.SunuID=d,e.sunuidInstance=null,e.initSunuID=function(n){try{return e.sunuidInstance=new d(n),e.sunuidInstance}catch(e){throw console.error("Erreur lors de l'initialisation de SunuID:",e),e}}}(window)}();
//# sourceMappingURL=sunuid-sdk.min.js.map
