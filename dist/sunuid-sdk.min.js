!function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function t(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}function n(e){return function(){var n=this,r=arguments;return new Promise(function(o,i){var s=e.apply(n,r);function a(e){t(s,o,i,a,c,"next",e)}function c(e){t(s,o,i,a,c,"throw",e)}a(void 0)})}}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,d(r.key),r)}}function o(e,t,n){return(t=d(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function a(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var a=r&&r.prototype instanceof l?r:l,u=Object.create(a.prototype);return c(u,"_invoke",function(n,r,o){var i,a,c,l=0,u=o||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return i=t,a=0,c=e,f.n=n,s}};function p(n,r){for(a=n,c=r,t=0;!d&&l&&!o&&t<u.length;t++){var o,i=u[t],p=f.p,h=i[2];n>3?(o=h===r)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=n<2&&p<i[1])?(a=0,f.v=r,f.n=i[1]):p<h&&(o=n<3||i[0]>r||r>h)&&(i[4]=n,i[5]=r,f.n=h,a=0))}if(o||n>1)return s;throw d=!0,r}return function(o,u,h){if(l>1)throw TypeError("Generator is already running");for(d&&1===u&&p(u,h),a=u,c=h;(t=a<2?e:c)||!d;){i||(a?a<3?(a>1&&(f.n=-1),p(a,c)):f.n=c:f.v=c);try{if(l=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(d=f.n<0)?c:n.call(r,f))!==s)break}catch(t){i=e,a=1,c=t}finally{l=1}}return{value:t,done:d}}}(n,o,i),!0),u}var s={};function l(){}function u(){}function d(){}t=Object.getPrototypeOf;var f=[][r]?t(t([][r]())):(c(t={},r,function(){return this}),t),p=d.prototype=l.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return u.prototype=d,c(p,"constructor",d),c(d,"constructor",u),u.displayName="GeneratorFunction",c(d,o,"GeneratorFunction"),c(p),c(p,o,"Generator"),c(p,r,function(){return this}),c(p,"toString",function(){return"[object Generator]"}),(a=function(){return{w:i,m:h}})()}function c(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}c=function(e,t,n,r){function i(t,n){c(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},c(e,t,n,r)}function l(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(typeof e+" is not iterable")}function u(t,n){return function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,s,a=[],c=!0,l=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw o}}return a}}(t,n)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}
/**
   * SunuID SDK - Package d'int√©gration pour partenaires
   * 
   * @version 1.0.0
   * @author SunuID Team
   * @license MIT
   */(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}!function(e,t){var o,i,c={apiUrl:(null===(t=e.SunuIDConfig)||void 0===t?void 0:t.apiUrl)||"https://api.sunuid.fayma.sn",clientId:null,secretId:null,type:2,partnerName:null,theme:"light",language:"fr",autoRefresh:!1,refreshInterval:3e4,autoInit:!1,onSuccess:null,onError:null,onStatusUpdate:null,onExpired:null,enableSecurityLogs:!0,validateInputs:!0,maxRetries:3,requestTimeout:1e4,secureInit:!1,secureInitUrl:null!==(o=e.SunuIDConfig)&&void 0!==o&&null!==(o=o.apiUrl)&&void 0!==o&&o.includes("api.sunuid.fayma.sn")?"https://api.sunuid.fayma.sn/secure-init.php":(null===(i=e.SunuIDConfig)||void 0===i||null===(i=i.apiUrl)||void 0===i?void 0:i.replace("/api",""))+"/secure-init.php"||"https://api.sunuid.fayma.sn/secure-init.php",token:null,forceRemoteServer:!0,useLocalFallback:!1,redirectAfterSuccess:null,verifySignature:!1,tokenMaxAge:300,onAuthenticationSuccess:null,onAuthenticationError:null,state:null},d=function(){return t=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=s(s({},c),t),this.qrCode=null,this.refreshTimer=null,this.isInitialized=!1,this.socket=null,this.initPromise=null,console.log("üîß SDK SunuID cr√©√© - Appelez init() manuellement")},o=[{key:"init",value:(q=n(a().m(function e(){return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(!this.isInitialized){e.n=1;break}return console.log("‚ö†Ô∏è SDK d√©j√† initialis√©, ignor√©"),e.a(2);case 1:if(!this.initPromise){e.n=2;break}return console.log("‚ö†Ô∏è Initialisation d√©j√† en cours, attente..."),e.a(2,this.initPromise);case 2:if(!this._initInProgress){e.n=3;break}return console.log("‚ö†Ô∏è Initialisation en cours, ignor√©"),e.a(2);case 3:return this._initInProgress=!0,this.initPromise=this._doInit(),e.p=4,e.n=5,this.initPromise;case 5:return e.p=5,this._initInProgress=!1,e.f(5);case 6:return e.a(2,this.initPromise)}},e,this,[[4,,5,6]])})),function(){return q.apply(this,arguments)})},{key:"_doInit",value:(D=n(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!this.handleCallback()){e.n=1;break}return console.log("‚úÖ Callback trait√©, initialisation termin√©e"),e.a(2);case 1:if(!this.config.secureInit){e.n=3;break}return e.n=2,this.secureInit();case 2:e.n=4;break;case 3:this.config.validateInputs&&this.validateSecurityParams();case 4:return this.logSecurityEvent("SDK_INIT_START",{apiUrl:this.config.apiUrl,type:this.config.type,secureInit:this.config.secureInit}),e.n=5,this.fetchPartnerInfo();case 5:this.obfuscateCredentials(),this.isInitialized=!0,console.log("SunuID SDK initialis√© avec succ√®s"),console.log("üìã Configuration SDK:",{apiUrl:this.config.apiUrl,type:this.config.type,partnerName:this.config.partnerName,clientId:this.config.clientId?"***"+this.config.clientId.slice(-4):"null",secretId:this.config.secretId?"***"+this.config.secretId.slice(-4):"null",secureInit:this.config.secureInit,theme:this.config.theme}),this.logSecurityEvent("SDK_INIT_SUCCESS"),this.initWebSocket(),e.n=7;break;case 6:throw e.p=6,t=e.v,this.logSecurityEvent("SDK_INIT_ERROR",{error:t.message}),t;case 7:return e.a(2)}},e,this,[[0,6]])})),function(){return D.apply(this,arguments)})},{key:"secureInit",value:(T=n(a().m(function e(){var t,n,r,o,i;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,this.logSecurityEvent("SECURE_INIT_START"),t={type:this.config.type,partnerName:this.config.partnerName,theme:this.config.theme},e.n=1,fetch(this.config.secureInitUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)});case 1:if((n=e.v).ok){e.n=2;break}throw new Error("Erreur HTTP: ".concat(n.status));case 2:return e.n=3,n.json();case 3:if(r=e.v,console.log("üìã R√©ponse initialisation s√©curis√©e:",r),r.success){e.n=4;break}throw new Error(r.error||"Erreur lors de l'initialisation s√©curis√©e");case 4:if(this.config.token=r.data.token,this.config.apiUrl=r.data.api_url,!(o=this.decodeSecureToken(r.data.token))){e.n=5;break}this.config.clientId=o.client_id,this.config.secretId=o.secret_id,e.n=6;break;case 5:throw new Error("Impossible de d√©coder le token s√©curis√©");case 6:this.config.expiresIn=r.data.expires_in,this.config.maxRequests=r.data.max_requests,this.config.requestCount=0,this.logSecurityEvent("SECURE_INIT_SUCCESS",{expiresIn:r.data.expires_in,maxRequests:r.data.max_requests}),console.log("‚úÖ Initialisation s√©curis√©e r√©ussie"),e.n=8;break;case 7:throw e.p=7,i=e.v,this.logSecurityEvent("SECURE_INIT_ERROR",{error:i.message}),new Error("√âchec de l'initialisation s√©curis√©e: ".concat(i.message));case 8:return e.a(2)}},e,this,[[0,7]])})),function(){return T.apply(this,arguments)})},{key:"decodeSecureToken",value:function(e){try{var t=e.split(".");if(2!==t.length)return console.error("‚ùå Format de token invalide"),null;var n=u(t,2),r=n[0],o=(n[1],atob(r)),i=JSON.parse(o);return i.exp&&i.exp<Date.now()/1e3?(console.error("‚ùå Token expir√©"),null):(console.log("‚úÖ Token d√©cod√© avec succ√®s"),i)}catch(e){return console.error("‚ùå Erreur d√©codage token:",e),null}}},{key:"initWebSocket",value:function(){var e=this;try{if("undefined"==typeof io)return console.warn("‚ö†Ô∏è Socket.IO non disponible, WebSocket sera initialis√© plus tard"),void setTimeout(function(){return e.initWebSocket()},1e3);var t=this.getClientIP();this.socket?console.log("üåê WebSocket d√©j√† connect√©"):(console.log("üåê Initialisation Socket.IO..."),this.socket=io("wss://samasocket.fayma.sn:9443",{query:{token:this.config.clientId,type:"web",userId:this.config.clientId,username:t},transports:["websocket","polling"]}),this.socket.on("connect",function(){console.log("üåê WebSocket connect√© avec succ√®s"),console.log("üìä Socket ID:",e.socket.id),e.socket.connected=!0}),this.socket.on("disconnect",function(t){console.log("‚ùå WebSocket d√©connect√©:",t),e.socket.connected=!1}),this.socket.on("connect_error",function(t){console.error("‚ùå Erreur connexion WebSocket:",t),e.socket.connected=!1}),this.socket.on("qr_status_update",function(t){console.log("üì± Mise √† jour statut QR re√ßue:",t),e.handleQRStatusUpdate(t)}),this.socket.on("qr_scan_success",function(t){console.log("‚úÖ Scan QR r√©ussi re√ßu:",t),e.handleQRScanSuccess(t)}),this.socket.on("qr_expired",function(t){console.log("‚è∞ QR expir√© re√ßu:",t),e.handleQRExpired(t)}),this.socket.on("qr_scan_initiated",function(t){console.log("üîç QR Scan Initiated re√ßu:",t),e.showQRLoader()}),this.socket.on("message",function(t){console.log("üì® Message socket re√ßu:",t),t&&"qr_scan_initiated"===t.type&&(console.log("üîç QR Scan Initiated d√©tect√© dans message:",t),e.showQRLoader())}),this.socket.onAny=this.socket.onAny||function(e,t){console.log("üåê Socket Event [".concat(e,"]:"),t)},this.socket.onAny(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];console.log("üåê Socket Event [".concat(e,"]:"),n)}))}catch(e){console.error("‚ùå Erreur initialisation WebSocket:",e)}}},{key:"getClientIP",value:function(){return"127.0.0.1"}},{key:"getTypeName",value:function(e){switch(e){case 1:return"KYC";case 2:return"AUTH";case 3:return"SIGNATURE";default:return"TYPE-".concat(e)}}},{key:"validateSecurityParams",value:function(){var e=[];if(this.config.clientId&&"string"==typeof this.config.clientId?this.config.clientId.length<10&&e.push("clientId trop court"):e.push("clientId invalide ou manquant"),this.config.secretId&&"string"==typeof this.config.secretId?this.config.secretId.length<32&&e.push("secretId trop court (minimum 32 caract√®res)"):e.push("secretId invalide ou manquant"),this.config.apiUrl&&this.isValidUrl(this.config.apiUrl)||e.push("apiUrl invalide"),[1,2,3].includes(this.config.type)||e.push("type invalide (doit √™tre 1, 2 ou 3)"),e.length>0)throw this.logSecurityEvent("VALIDATION_ERROR",{errors:e}),new Error("Param√®tres de s√©curit√© invalides: ".concat(e.join(", ")));this.logSecurityEvent("VALIDATION_SUCCESS")}},{key:"isValidUrl",value:function(e){try{var t=new URL(e);return"https:"===t.protocol||"http:"===t.protocol}catch(e){return!1}}},{key:"logSecurityEvent",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.config.enableSecurityLogs){var r={timestamp:(new Date).toISOString(),event:t,data:n,userAgent:navigator.userAgent,url:e.location.href};console.warn("üîí [SECURITY]",r),e.SunuIDSecurityLogs||(e.SunuIDSecurityLogs=[]),e.SunuIDSecurityLogs.push(r)}}},{key:"obfuscateCredentials",value:function(){this.config.originalClientId=this.config.clientId,this.config.originalSecretId=this.config.secretId,this.config.clientId&&(this.config.clientIdDisplay=this.config.clientId.replace(/(.{3}).*(.{3})/,"$1***$2")),this.config.secretId&&(this.config.secretIdDisplay=this.config.secretId.replace(/(.{4}).*(.{4})/,"$1***$2"))}},{key:"sanitizeInput",value:function(e){return"string"!=typeof e?e:e.replace(/[<>]/g,"").replace(/javascript:/gi,"").trim()}},{key:"handleQRStatusUpdate",value:function(e){console.log("üì± QR Status Update:",e),this.config.onStatusUpdate&&this.config.onStatusUpdate(e)}},{key:"handleQRScanSuccess",value:function(e){console.log("‚úÖ QR Scan Success re√ßu:",e);try{var t=this.extractAuthDataFromWebSocket(e);this.processAuthentication(t),this.showSuccessMessage(t),this.config.onSuccess&&this.config.onSuccess(t),console.log("‚úÖ Authentification WebSocket trait√©e avec succ√®s")}catch(t){console.error("‚ùå Erreur lors du traitement WebSocket:",t),this.config.onAuthenticationError&&this.config.onAuthenticationError(t,e)}}},{key:"handleQRExpired",value:function(e){console.log("‚è∞ QR Expired:",e),this.config.onExpired&&this.config.onExpired(e)}},{key:"emitWebSocketEvent",value:function(e,t){this.socket&&this.socket.connected?(this.socket.emit(e,t),console.log("üì§ √âv√©nement WebSocket √©mis: ".concat(e),t)):console.warn("‚ö†Ô∏è WebSocket non connect√©, impossible d'√©mettre l'√©v√©nement:",e)}},{key:"getWebSocketStatus",value:function(){return this.socket?this.socket.connected?"connected":"disconnected":"not_initialized"}},{key:"forceWebSocketInit",value:function(){"undefined"==typeof io||this.socket||(console.log("üîÑ For√ßage de l'initialisation WebSocket..."),this.initWebSocket())}},{key:"generateQR",value:(Q=n(a().m(function t(){var n,r,o,i,c,l,u,d,f,p,h,g=arguments;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if(n=g.length>0&&void 0!==g[0]?g[0]:"sunuid-qr-container",r=g.length>1&&void 0!==g[1]?g[1]:{},!this.initPromise){t.n=2;break}return t.n=1,this.initPromise;case 1:this.initPromise=null;case 2:if(this.isInitialized){t.n=3;break}throw new Error("SunuID: SDK non initialis√©");case 3:return console.log("üéØ generateQR appel√© avec containerId:",n),console.log("üîç Attente connexions API et WebSocket..."),t.p=4,t.n=5,this.waitForConnections(5e3);case 5:o=t.v,console.log("‚úÖ Connexions pr√™tes:",o),t.n=7;break;case 6:throw t.p=6,p=t.v,console.error("‚ùå Erreur connexions:",p.message),new Error("Connexions non disponibles - Impossible de g√©n√©rer le QR code");case 7:return t.p=7,i=this.socket?this.socket.id:"timeout-socket-id",c=i,console.log("üìÑ Contenu QR pr√©par√©:",c),console.log("üîå Socket ID:",i),l=this.config.partnerName||"Partner_unknown",t.n=8,this.makeRequest("/qr-generate",s({type:this.config.type,data:c,label:"".concat(this.getTypeName(this.config.type)," ").concat(l)},r));case 8:if(!(u=t.v).success){t.n=11;break}if(console.log("üìã R√©ponse QR API compl√®te:",u),console.log("üìã Structure response.data:",u.data),(d=u.data.qrCodeUrl)&&d.startsWith("/")&&(d="".concat(this.config.apiUrl).concat(d)),d){t.n=10;break}if(console.warn("‚ö†Ô∏è qrCodeUrl non trouv√© dans la r√©ponse, recherche d'alternatives..."),!(d=u.data.qr_url||u.data.qrUrl||u.data.url||u.data.image_url||u.data.imageUrl)){t.n=9;break}console.log("‚úÖ URL QR trouv√©e dans un champ alternatif:",d),t.n=10;break;case 9:throw console.error("‚ùå Aucune URL QR trouv√©e dans la r√©ponse"),new Error("URL du QR code non trouv√©e dans la r√©ponse API");case 10:return this.currentQRUrl=d,console.log("‚úÖ QR code g√©n√©r√© par API principale:",d),console.log("üìÑ Contenu QR final:",c),console.log("üè∑Ô∏è Label QR:",u.data.label||"N/A"),console.log("üÜî Session ID:",u.data.sessionId||"N/A"),this.displayQRCode(n,d,this.config.type,r),this.startAutoRefresh(n,this.config.type,r),this.emitWebSocketEvent("qr_generated",{type:this.config.type,qrCodeUrl:d,socketId:i,qrContent:c,label:u.data.label,sessionId:u.data.sessionId,timestamp:Date.now()}),t.a(2,s(s({},u.data),{},{qrCodeUrl:d,qrContent:c,label:u.data.label,sessionId:u.data.sessionId}));case 11:throw new Error(u.message||"Erreur lors de la g√©n√©ration du QR code");case 12:t.n=14;break;case 13:throw t.p=13,h=t.v,console.error("Erreur API d√©tect√©e:",h.message),console.error("Stack trace complet:",h.stack),console.error("Configuration SDK:",{apiUrl:this.config.apiUrl,type:this.config.type,secureInit:this.config.secureInit,clientId:this.config.clientId?"***"+this.config.clientId.slice(-4):"null",secretId:this.config.secretId?"***"+this.config.secretId.slice(-4):"null"}),this.config.useLocalFallback?(console.log("üîç V√©rification fallback local..."),console.log("üîç Hostname:",e.location.hostname),console.log("üîç Protocol:",e.location.protocol),console.log("üîç URL compl√®te:",e.location.href),f="localhost"===e.location.hostname||"127.0.0.1"===e.location.hostname||"file:"===e.location.protocol,console.log("üîç Est local:",f),f?(console.log("üîÑ Tentative fallback vers service QR local..."),console.log("‚ùå Fallback local non impl√©ment√© - utilisation serveur distant uniquement")):console.log("‚ùå Pas en local, pas de fallback")):console.log("üîí Fallback local d√©sactiv√©, utilisation serveur distant uniquement"),console.log('Affichage du message "Service non disponible" pour type '+this.config.type),this.displayServiceUnavailable(n,this.config.type),new Error("Service non disponible");case 14:return t.a(2)}},t,this,[[7,13],[4,6]])})),function(){return Q.apply(this,arguments)})},{key:"generateCustomQR",value:(C=n(a().m(function e(t,n){var r,o,i,c,l=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=l.length>2&&void 0!==l[2]?l[2]:{},!this.initPromise){e.n=2;break}return e.n=1,this.initPromise;case 1:this.initPromise=null;case 2:if(this.isInitialized){e.n=3;break}throw new Error("SunuID: SDK non initialis√©");case 3:return e.p=3,e.n=4,this.makeRequest("/qr-generate",s({type:n},r));case 4:if(!(o=e.v).success){e.n=5;break}return i="".concat("https://sunuid.fayma.sn").concat(o.data.qrcode),this.displayQRCode(t,i,n,r),console.log("‚úÖ QR code personnalis√© g√©n√©r√© par API principale:",i),console.log("üìÑ Code de session:",o.data.code),console.log("üÜî Service ID:",o.data.service_id),this.startAutoRefresh(t,n,r),e.a(2,s(s({},o.data),{},{qrCodeUrl:i,sessionId:o.data.service_id}));case 5:throw new Error(o.message||"Erreur lors de la g√©n√©ration du QR code");case 6:e.n=8;break;case 7:throw e.p=7,c=e.v,console.error("Erreur API d√©tect√©e:",c.message),console.error("Stack trace complet:",c.stack),console.error("Configuration SDK (Custom):",{apiUrl:this.config.apiUrl,type:n,secureInit:this.config.secureInit,clientId:this.config.clientId?"***"+this.config.clientId.slice(-4):"null",secretId:this.config.secretId?"***"+this.config.secretId.slice(-4):"null"}),console.log('Affichage du message "Service non disponible" pour type '+n),this.displayServiceUnavailable(t,n),new Error("Service non disponible");case 8:return e.a(2)}},e,this,[[3,7]])})),function(e,t){return C.apply(this,arguments)})},{key:"generateAuthQR",value:(x=n(a().m(function e(t){var n,r=arguments;return a().w(function(e){for(;;)if(0===e.n)return n=r.length>1&&void 0!==r[1]?r[1]:{},e.a(2,this.generateQR(t,n))},e,this)})),function(e){return x.apply(this,arguments)})},{key:"generateKYCQR",value:(E=n(a().m(function e(t){var n,r,o=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=this.config.type,this.config.type=1,e.p=1,e.n=2,this.generateQR(t,n);case 2:return e.a(2,e.v);case 3:return e.p=3,this.config.type=r,e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])})),function(e){return E.apply(this,arguments)})},{key:"generateSignatureQR",value:(R=n(a().m(function e(t){var n,r,o=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=this.config.type,this.config.type=3,e.p=1,e.n=2,this.generateQR(t,n);case 2:return e.a(2,e.v);case 3:return e.p=3,this.config.type=r,e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])})),function(e){return R.apply(this,arguments)})},{key:"checkQRStatus",value:(w=n(a().m(function e(t){var n,r;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.isInitialized){e.n=1;break}throw new Error("SunuID: SDK non initialis√©");case 1:return e.p=1,e.n=2,this.makeRequest("/qr-status",{serviceId:t});case 2:if(!(n=e.v).success){e.n=3;break}return e.a(2,n.data);case 3:throw new Error(n.message||"Erreur lors de la v√©rification du statut");case 4:e.n=6;break;case 5:throw e.p=5,r=e.v,this.handleError(r),r;case 6:return e.a(2)}},e,this,[[1,5]])})),function(e){return w.apply(this,arguments)})},{key:"generateQRWithContent",value:(_=n(a().m(function t(n,r,o){var i,s,c,l=arguments;return a().w(function(t){for(;;)switch(t.p=t.n){case 0:if(i=l.length>3&&void 0!==l[3]?l[3]:{},console.log("üé® G√©n√©ration QR avec contenu:",n),t.p=1,"localhost"!==e.location.hostname&&"127.0.0.1"!==e.location.hostname&&"file:"!==e.location.protocol){t.n=3;break}return console.log("üè† Utilisation service QR local..."),t.n=2,this.generateQRLocal(n,r,o,i);case 2:if(!(s=t.v)){t.n=3;break}return t.a(2,s);case 3:return console.log("üåê Utilisation service QR distant..."),t.n=4,this.generateQRRemote(n,r,o,i);case 4:return t.a(2,t.v);case 5:return t.p=5,c=t.v,console.error("‚ùå Erreur g√©n√©ration QR:",c),this.displayQRContent(r,n,o,i),t.a(2,null)}},t,this,[[1,5]])})),function(e,t,n){return _.apply(this,arguments)})},{key:"generateQRLocal",value:(I=n(a().m(function e(t,n,r){var o,i,s,c,l,u=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return o=u.length>3&&void 0!==u[3]?u[3]:{},e.p=1,e.n=2,fetch("http://localhost:8000/api/generate/text",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"text=".concat(encodeURIComponent(t),"&size=300")});case 2:if(!(i=e.v).ok){e.n=4;break}return e.n=3,i.json();case 3:return s=e.v,c="data:image/png;base64,".concat(s.qrcode),this.displayQRCode(n,c,r,o),e.a(2,c);case 4:e.n=6;break;case 5:e.p=5,l=e.v,console.log("‚ùå Service QR local non disponible:",l.message);case 6:return e.a(2,null)}},e,this,[[1,5]])})),function(e,t,n){return I.apply(this,arguments)})},{key:"generateQRRemote",value:(S=n(a().m(function e(t,n,r){var o,i,s,c,l,u=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return o=u.length>3&&void 0!==u[3]?u[3]:{},e.p=1,e.n=2,fetch("https://api.sunuid.fayma.sn/qr-generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t,size:300,type:r})});case 2:if(!(i=e.v).ok){e.n=4;break}return e.n=3,i.json();case 3:return s=e.v,c="data:image/png;base64,".concat(s.qrcode),this.displayQRCode(n,c,r,o),e.a(2,c);case 4:e.n=6;break;case 5:e.p=5,l=e.v,console.error("‚ùå Erreur service QR distant:",l);case 6:return this.displayQRContent(n,t,r,o),e.a(2,null)}},e,this,[[1,5]])})),function(e,t,n){return S.apply(this,arguments)})},{key:"displayQRContent",value:function(e,t,n){var r=document.getElementById(e);if(!r)throw new Error("Conteneur avec l'ID \"".concat(e,'" non trouv√©'));var o=this.getTypeName(n);r.innerHTML='\n                <div class="sunuid-qr-code">\n                    <div class="sunuid-qr-header">\n                        <h3>'.concat(o,'</h3>\n                    </div>\n                    <div class="sunuid-qr-content" style="text-align: center; padding: 20px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 5px; margin: 10px 0;">\n                        <p><strong>Contenu QR Code:</strong></p>\n                        <p style="font-family: monospace; font-size: 14px; word-break: break-all;">').concat(t,'</p>\n                    </div>\n                    <div class="sunuid-qr-instructions">\n                        <p>Contenu QR g√©n√©r√© avec le format: {type}-{code}-{socketid}</p>\n                    </div>\n                </div>\n            '),console.log("‚úÖ Contenu QR affich√©:",t)}},{key:"displayQRCode",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=document.getElementById(e);if(!o)throw new Error("Conteneur avec l'ID \"".concat(e,'" non trouv√©'));o.innerHTML="";var i=document.createElement("div");i.className="sunuid-qr-code";var s=this.getTypeName(n);i.innerHTML='\n                <div class="sunuid-qr-header">\n                    <h3>'.concat(1===n?"V√©rification KYC":2===n?"Authentification":3===n?"Signature":"Service Type "+n,'</h3>\n                </div>\n                <div class="sunuid-qr-image">\n                    <img src="').concat(t,'" alt="QR Code ').concat(s,'" style="max-width: 300px; border: 1px solid #ddd; border-radius: 5px;" />\n                </div>\n               \n            '),o.appendChild(i),this.applyTheme(r.theme||this.config.theme),console.log("‚úÖ QR code affich√©:",t)}},{key:"generateCustomQRCode",value:(k=n(a().m(function e(t,n){var r,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(console.log("üé® D√©but g√©n√©ration QR personnalis√©..."),console.log("üìÑ Contenu:",t),console.log("üè∑Ô∏è Label:",n),(r=document.getElementById("sunuid-qr-container"))||(r=document.getElementById("qr-container")),r){e.n=1;break}return console.error("‚ùå QR container not found"),e.a(2);case 1:return console.log("‚úÖ QR container trouv√©"),r.innerHTML='<div style="text-align: center; padding: 20px;"><p>G√©n√©ration QR code...</p></div>',e.p=2,console.log("üé® Tentative g√©n√©ration via API principale..."),e.n=3,this.generateQRPHP(t,n,r);case 3:console.log("‚úÖ QR code g√©n√©r√© avec succ√®s"),e.n=5;break;case 4:e.p=4,o=e.v,console.error("‚ùå Erreur g√©n√©ration API:",o),console.log("‚ö†Ô∏è Affichage image par d√©faut"),this.displayDefaultQR(r,t,n);case 5:return e.a(2)}},e,this,[[2,4]])})),function(e,t){return k.apply(this,arguments)})},{key:"generateQRClientSide",value:(b=n(a().m(function e(t,n,r){var o,i,s=this;return a().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.ensureQRCodeLibrary();case 1:if("undefined"!=typeof QRCode){e.n=2;break}throw new Error("QRCode library non disponible");case 2:return(o=document.createElement("canvas")).width=300,o.height=320,(i=o.getContext("2d")).fillStyle="#FFFFFF",i.fillRect(0,0,300,320),e.a(2,new Promise(function(e,a){QRCode.toCanvas(o,t,{width:280,margin:10,color:{dark:"#000000",light:"#FFFFFF"}},function(t){if(t)a(t);else{i.fillStyle="#333333",i.font="bold 14px Arial",i.textAlign="center",i.fillText(n,150,305);var c=o.toDataURL("image/png");s.currentQRUrl=c,r.innerHTML='\n                        <div style="text-align: center; padding: 20px;">\n                            <img src="'.concat(c,'" alt="QR Code" style="max-width: 300px; border: 2px solid #ddd; border-radius: 10px;">\n                        </div>\n                    '),s.showQRInstructions(r),e()}})}))}},e,this)})),function(e,t,n){return b.apply(this,arguments)})},{key:"generateQRPHP",value:(m=n(a().m(function e(t,n,r){var o,i,s,c,l,u;return a().w(function(e){for(;;)switch(e.n){case 0:return o=this.config.forceRemoteServer||this.config.apiUrl.includes("api.sunuid.fayma.sn")?"https://api.sunuid.fayma.sn/qr-generate":this.config.apiUrl.includes("localhost")||this.config.apiUrl.includes("127.0.0.1")?"http://localhost:8000/api/generate/text":this.config.apiUrl+"/qr-generate",console.log("üîó URL QR Generator:",o),o.includes("localhost:8000")?(s="application/x-www-form-urlencoded",i=new URLSearchParams({text:t,size:300,margin:10,foreground_color:"000000",background_color:"FFFFFF"})):(s="application/json",i=JSON.stringify({type:this.config.type,client_id:this.config.clientId,secret_id:this.config.secretId,content:t,label:n})),e.n=1,fetch(o,{method:"POST",headers:{"Content-Type":s,Accept:"application/json"},body:i});case 1:if((c=e.v).ok){e.n=2;break}throw new Error("Erreur HTTP: ".concat(c.status));case 2:return e.n=3,c.json();case 3:if((l=e.v).success){e.n=4;break}throw new Error("Erreur QR: ".concat(l.error));case 4:u=o.includes("localhost:8000")?l.data_uri:"".concat("https://sunuid.fayma.sn").concat(l.data.qrcode),this.currentQRUrl=u,r.innerHTML='\n                 <div style="text-align: center; padding: 20px;">\n                     <img src="'.concat(u,'" alt="QR Code" style="max-width: 300px; border: 2px solid #ddd; border-radius: 10px;">\n                 </div>\n             '),this.showQRInstructions(r);case 5:return e.a(2)}},e,this)})),function(e,t,n){return m.apply(this,arguments)})},{key:"displayDefaultQR",value:function(e,t,n){e.innerHTML='\n                <div style="text-align: center; padding: 20px; color: #666;">\n                    <div style="width: 300px; height: 300px; background: #f0f0f0; border: 2px solid #ddd; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">\n                        <div>\n                            <p style="font-size: 24px; margin: 0;">üì±</p>\n                            <p style="font-size: 14px; margin: 10px 0 0 0;">QR Code</p>\n                        </div>\n                    </div>\n                    <p style="margin-top: 10px; font-size: 12px;">'.concat(n,'</p>\n                    <p style="font-size: 10px; color: #999; margin-top: 5px;">Contenu: ').concat(t,"</p>\n                </div>\n            ")}},{key:"ensureQRCodeLibrary",value:(y=n(a().m(function e(){return a().w(function(e){for(;;)switch(e.n){case 0:if("undefined"==typeof QRCode){e.n=1;break}return console.log("‚úÖ QRCode library d√©j√† disponible"),e.a(2,!0);case 1:return console.log("üì¶ Chargement QRCode library..."),e.a(2,new Promise(function(e,t){var n=document.createElement("script");n.src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/lib/browser.min.js",n.onload=function(){setTimeout(function(){"undefined"!=typeof QRCode?(console.log("‚úÖ QRCode library charg√©e"),e(!0)):(console.error("‚ùå QRCode non disponible apr√®s chargement"),t(new Error("QRCode library non disponible apr√®s chargement")))},200)},n.onerror=function(){console.error("‚ùå Erreur chargement QRCode library"),t(new Error("Erreur chargement QRCode library"))},document.head.appendChild(n)}))}},e)})),function(){return y.apply(this,arguments)})},{key:"showQRInstructions",value:function(e){var t=e.parentElement.querySelector(".sunuid-qr-instructions"),n=e.parentElement.querySelector(".sunuid-qr-status");t&&(t.style.display="block",t.classList.add("sunuid-qr-ready")),n&&(n.style.display="block",n.classList.add("sunuid-qr-ready"))}},{key:"addLogoToCenter",value:function(e,t,n,r,o){try{var i=new Image;i.onload=function(){var o=40,s=t+(r-o)/2,a=n+(r-o)/2;e.fillStyle="white",e.fillRect(s-2,a-2,44,44),e.drawImage(i,s,a,o,o)},i.src="src/logoqr.png"}catch(e){console.warn("Logo non disponible:",e)}}},{key:"displayFallbackImage",value:function(){console.log("‚ö†Ô∏è Affichage de l'image de fallback");var e=document.getElementById("sunuid-qr-container");e&&(e.innerHTML='\n                    <div style="text-align: center; padding: 20px; color: #666;">\n                        <p>‚ö†Ô∏è G√©n√©ration QR personnalis√© non disponible</p>\n                        <p>Utilisation de l\'image par d√©faut</p>\n                        <p><strong>Debug:</strong> QRCode disponible: '.concat("undefined"!=typeof QRCode,"</p>\n                        <p><strong>Debug:</strong> Container trouv√©: ").concat(null!==e,"</p>\n                    </div>\n                "))}},{key:"displayServiceUnavailable",value:function(e,t){console.log("displayServiceUnavailable appel√©e pour ".concat(e,", type: ").concat(t));var n=document.getElementById(e);n?n.innerHTML='\n                <div class="sunuid-service-unavailable" style="\n                    text-align: center;\n                    padding: 40px 20px;\n                    background: #f8f9fa;\n                    border: 2px dashed #dee2e6;\n                    border-radius: 10px;\n                    color: #6c757d;\n                    font-family: Arial, sans-serif;\n                ">\n                    <div style="font-size: 48px; margin-bottom: 20px;">‚ö†Ô∏è</div>\n                    <h3 style="margin: 0 0 10px 0; color: #495057;">Service Non Disponible</h3>\n                    <p style="margin: 0; font-size: 14px;">\n                        Le service d\'authentification est temporairement indisponible.<br>\n                        Veuillez r√©essayer plus tard.\n                    </p>\n                    <div style="margin-top: 20px; font-size: 12px; color: #adb5bd;">\n                        Type: '.concat(String(t).toUpperCase(),"\n                    </div>\n                </div>\n            "):console.error("Container ".concat(e," non trouv√©"))}},{key:"refreshQR",value:(v=n(a().m(function e(t){var n,r,o,i,s=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:{},e.p=1,!this.currentQRUrl){e.n=3;break}return console.log("üîÑ V√©rification du statut du QR code existant..."),e.n=2,this.generateQR(t,n);case 2:return r=e.v,e.a(2,r);case 3:return console.log("üîÑ Pas de QR code existant, g√©n√©ration d'un nouveau..."),e.n=4,this.generateQR(t,n);case 4:return o=e.v,e.a(2,o);case 5:e.n=7;break;case 6:throw e.p=6,i=e.v,console.error("Erreur lors du rafra√Æchissement:",i.message),this.displayServiceUnavailable(t,this.config.type),i;case 7:return e.a(2)}},e,this,[[1,6]])})),function(e){return v.apply(this,arguments)})},{key:"startAutoRefresh",value:function(e,t,r){var o=this;this.config.autoRefresh&&(this.refreshTimer&&(clearInterval(this.refreshTimer),console.log("üîÑ Timer de rafra√Æchissement pr√©c√©dent arr√™t√©")),this.refreshTimer=setInterval(n(a().m(function n(){var i;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,console.log("üîÑ Rafra√Æchissement automatique du QR code..."),n.n=1,o.refreshQR(e,t,r);case 1:n.n=3;break;case 2:n.p=2,i=n.v,console.warn("Erreur lors du rafra√Æchissement automatique:",i);case 3:return n.a(2)}},n,null,[[0,2]])})),this.config.refreshInterval),console.log("üîÑ Timer de rafra√Æchissement d√©marr√© (".concat(this.config.refreshInterval,"ms)")))}},{key:"makeRequest",value:(g=n(a().m(function t(n,r){var o,i,s,c,u,d,f,p,h,g=this;return a().w(function(t){for(;;)switch(t.n){case 0:if(this.isInitialized){t.n=1;break}throw this.logSecurityEvent("REQUEST_BEFORE_INIT",{endpoint:n}),new Error("SDK non initialis√©");case 1:if(!this.config.secureInit){t.n=2;break}if(this.config.requestCount++,!(this.config.requestCount>this.config.maxRequests)){t.n=2;break}throw this.logSecurityEvent("API_REQUEST_LIMIT_EXCEEDED",{requestCount:this.config.requestCount,maxRequests:this.config.maxRequests}),new Error("Limite de requ√™tes d√©pass√©e");case 2:s=this.sanitizeRequestData(r),console.log("üîç Debug makeRequest - endpoint:",n),console.log("üîç Debug makeRequest - apiUrl:",this.config.apiUrl),console.log("üîç Debug makeRequest - url:","".concat(this.config.apiUrl).concat(n)),console.log("üîç Debug makeRequest - data:",JSON.stringify(s,null,2)),console.log("üîç Debug makeRequest - secureInit:",this.config.secureInit),console.log("üîç Debug makeRequest - isInitialized:",this.isInitialized),c=(null===(o=e.SunuIDConfig)||void 0===o||null===(o=o.endpoints)||void 0===o?void 0:o[n.replace("/","")])||n,u="".concat(this.config.apiUrl).concat(c),console.log("üîç URL finale construite:",u),console.log("üîç EndpointPath:",c),console.log("üîç SunuIDConfig endpoints:",JSON.stringify(null===(i=e.SunuIDConfig)||void 0===i?void 0:i.endpoints)),this.logSecurityEvent("API_REQUEST_START",{endpoint:c,url:u,dataKeys:Object.keys(s),secureInit:this.config.secureInit}),d=0,f=this.config.maxRetries,p=a().m(function e(){var t,n,r,o,i,l,p,h;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=new AbortController,n=setTimeout(function(){return t.abort()},g.config.requestTimeout),r={"Content-Type":"application/json"},e.n=1,fetch(u,{method:"POST",headers:r,body:JSON.stringify(s),signal:t.signal});case 1:if(o=e.v,clearTimeout(n),o.ok){e.n=3;break}return e.n=2,o.text();case 2:i=e.v;try{l=JSON.parse(i)}catch(e){l={message:i}}throw g.logSecurityEvent("API_REQUEST_ERROR",{status:o.status,statusText:o.statusText,error:l.message}),new Error(l.message||"Erreur HTTP: ".concat(o.status));case 3:return e.n=4,o.json();case 4:return p=e.v,g.logSecurityEvent("API_REQUEST_SUCCESS",{endpoint:c,responseKeys:Object.keys(p)}),e.a(2,{v:p});case 5:if(e.p=5,h=e.v,d++,"AbortError"!==h.name){e.n=7;break}if(g.logSecurityEvent("API_REQUEST_TIMEOUT",{retryCount:d}),!(d>f)){e.n=6;break}throw new Error("Timeout de la requ√™te API");case 6:return e.a(2,0);case 7:if(!(d>f)){e.n=8;break}throw g.logSecurityEvent("API_REQUEST_MAX_RETRIES",{retryCount:d,error:h.message}),h;case 8:return e.n=9,new Promise(function(e){return setTimeout(e,1e3*d)});case 9:return e.a(2)}},e,null,[[0,5]])});case 3:if(!(d<=f)){t.n=7;break}return t.d(l(p()),4);case 4:if(0!==(h=t.v)){t.n=5;break}return t.a(3,3);case 5:if(!h){t.n=6;break}return t.a(2,h.v);case 6:t.n=3;break;case 7:return t.a(2)}},t,this)})),function(e,t){return g.apply(this,arguments)})},{key:"sanitizeRequestData",value:function(e){for(var t={},n=0,r=Object.entries(e);n<r.length;n++){var o=u(r[n],2),i=o[0],s=o[1];"string"==typeof s?t[i]=this.sanitizeInput(s):"object"===f(s)&&null!==s?t[i]=this.sanitizeRequestData(s):t[i]=s}return t.client_id=this.config.originalClientId||this.config.clientId,t.secret_id=this.config.originalSecretId||this.config.secretId,console.log("üîç Credentials dans sanitizeRequestData - clientId:",this.config.clientId),console.log("üîç Credentials dans sanitizeRequestData - secretId:",this.config.secretId?"***"+this.config.secretId.slice(-4):"null"),console.log("üîç Credentials dans sanitizeRequestData - sanitizedClientId:",t.client_id),console.log("üîç Credentials dans sanitizeRequestData - sanitizedSecretId:",t.secret_id?"***"+t.secret_id.slice(-4):"null"),console.log("üîç Credentials dans sanitizeRequestData - data complet:",JSON.stringify(t,null,2)),t}},{key:"generateRequestId",value:function(){return"req_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}},{key:"generateSessionCode",value:function(){var e=Date.now(),t=Math.random().toString(36).substr(2,9),n="".concat(e,"_").concat(t);return btoa(n)}},{key:"fetchPartnerInfo",value:(h=n(a().m(function e(){var t,n,r,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,this.makeRequest("/debug",{type:this.config.type,client_id:this.config.clientId,secret_id:this.config.secretId});case 1:t=e.v,console.log("üìã R√©ponse debug API:",t),t.success&&t.data?(n=t.data,r=null,n.partner_id?r=n.partner_id:n.authentication&&n.authentication.auth_test&&n.authentication.auth_test.partner_id?r=n.authentication.auth_test.partner_id:n.auth_test&&n.auth_test.partner_id&&(r=n.auth_test.partner_id),r?(this.config.partnerId=r,n.service_id?this.config.serviceId=n.service_id:this.config.serviceId=r,this.config.partnerName=21===r?"Fayma":"Partner_".concat(r),console.log("‚úÖ Informations partenaire r√©cup√©r√©es:",{partnerName:this.config.partnerName,partnerId:this.config.partnerId,serviceId:this.config.serviceId})):(console.warn("‚ö†Ô∏è Partner ID non trouv√© dans la r√©ponse, utilisation du partner_id par d√©faut"),this.config.partnerName="Partner_".concat(this.config.partnerId||"unknown"))):(console.warn("‚ö†Ô∏è Structure de r√©ponse invalide, utilisation du partner_id par d√©faut"),this.config.partnerName="Partner_".concat(this.config.partnerId||"unknown")),e.n=3;break;case 2:e.p=2,o=e.v,console.warn("‚ö†Ô∏è Erreur lors de la r√©cup√©ration des informations du partenaire:",o.message),this.config.partnerName="Partner_unknown";case 3:return e.a(2)}},e,this,[[0,2]])})),function(){return h.apply(this,arguments)})},{key:"applyTheme",value:function(e){var t=document.querySelector(".sunuid-qr-code");t&&(t.className="sunuid-qr-code sunuid-theme-".concat(e))}},{key:"handleError",value:function(e){console.error("SunuID SDK Error:",e),this.config.onError&&this.config.onError(e)}},{key:"checkConnections",value:(p=n(a().m(function e(){var t,n,r,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return t={api:!1,websocket:!1,ready:!1},e.p=1,e.n=2,fetch(this.config.apiUrl+"/debug",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:this.config.type,client_id:this.config.clientId,secret_id:this.config.secretId})});case 2:if(!(n=e.v).ok){e.n=4;break}return e.n=3,n.json();case 3:r=e.v,t.api=!0===r.success,console.log("üîç API Status:",t.api?"accessible":"inaccessible"),e.n=5;break;case 4:t.api=!1,console.log("üîç API Status: HTTP",n.status);case 5:e.n=7;break;case 6:e.p=6,o=e.v,console.log("üîç Test API √©chou√©:",o.message),t.api=!1;case 7:return t.websocket=this.socket&&this.socket.connected,t.ready=t.api,e.a(2,t)}},e,this,[[1,6]])})),function(){return p.apply(this,arguments)})},{key:"waitForConnections",value:(d=n(a().m(function e(){var t,n,r,o=arguments;return a().w(function(e){for(;;)switch(e.n){case 0:t=o.length>0&&void 0!==o[0]?o[0]:5e3,n=Date.now();case 1:if(!(Date.now()-n<t)){e.n=5;break}return e.n=2,this.checkConnections();case 2:if(!(r=e.v).ready){e.n=3;break}return console.log("‚úÖ Connexions pr√™tes"),e.a(2,r);case 3:return console.log("‚è≥ Attente connexions...",r),e.n=4,new Promise(function(e){return setTimeout(e,1e3)});case 4:e.n=1;break;case 5:throw new Error("Timeout connexions - Impossible de g√©n√©rer le QR code");case 6:return e.a(2)}},e,this)})),function(){return d.apply(this,arguments)})},{key:"getQRCode",value:function(){return this.currentQRUrl?this.currentQRUrl:null}},{key:"destroy",value:function(){this.stopAutoRefresh(),this.socket&&(this.socket.disconnect(),this.socket=null,console.log("üåê WebSocket d√©connect√©")),this.isInitialized=!1,this.logSecurityEvent("SDK_DESTROY"),console.log("SunuID SDK d√©truit")}},{key:"stopAutoRefresh",value:function(){this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null,console.log("üîÑ Timer de rafra√Æchissement arr√™t√©"))}},{key:"getSecurityLogs",value:function(){return e.SunuIDSecurityLogs||[]}},{key:"clearSecurityLogs",value:function(){e.SunuIDSecurityLogs=[],this.logSecurityEvent("SECURITY_LOGS_CLEARED")}},{key:"showQRLoader",value:function(){console.log("üîÑ Affichage du loader - Scan QR initi√©");for(var e=null,t=0,n=["qr-area","qr-container","sunuid-qr-container"];t<n.length;t++){var r=n[t];if(e=document.getElementById(r))break}e?(e.innerHTML='\n                <div style="\n                    text-align: center;\n                    padding: 40px 20px;\n                    background: #f8f9fa;\n                    border: 2px solid #007bff;\n                    border-radius: 10px;\n                    color: #007bff;\n                    font-family: Arial, sans-serif;\n                ">\n                    <div style="\n                        width: 60px;\n                        height: 60px;\n                        border: 4px solid #e3f2fd;\n                        border-top: 4px solid #007bff;\n                        border-radius: 50%;\n                        animation: spin 1s linear infinite;\n                        margin: 0 auto 20px auto;\n                    "></div>\n                    <h3 style="margin: 0 0 10px 0; color: #007bff;">üîç Scan en cours...</h3>\n                    <p style="margin: 0; font-size: 14px;">\n                        Veuillez patienter pendant la v√©rification de votre identit√©.\n                    </p>\n                    <div style="margin-top: 15px; font-size: 12px; color: #6c757d;">\n                        ‚è±Ô∏è Traitement en cours...\n                    </div>\n                </div>\n                <style>\n                    @keyframes spin {\n                        0% { transform: rotate(0deg); }\n                        100% { transform: rotate(360deg); }\n                    }\n                </style>\n            ',console.log("‚úÖ Loader affich√© avec succ√®s")):console.warn("‚ö†Ô∏è Conteneur QR non trouv√© pour afficher le loader")}},{key:"extractAuthDataFromWebSocket",value:function(e){if(console.log("üîç Extraction des donn√©es d'authentification du WebSocket:",e),console.log("üîç Structure compl√®te de websocketData:",JSON.stringify(e,null,2)),e.token&&e.session_id)return console.log("‚úÖ Donn√©es d√©j√† au bon format (callback)"),e;if(e.responseData){console.log("‚úÖ Format WebSocket d√©tect√©, extraction de responseData"),console.log("üîç Contenu complet de responseData:",e.responseData),console.log("üîç Cl√©s disponibles dans responseData:",Object.keys(e.responseData));var t=e.responseData,n=t.data||t;console.log("üîç Donn√©es d'authentification dans data:",n),console.log("üîç Cl√©s disponibles dans data:",Object.keys(n)),n.callback_data&&console.log("üîç Contenu de callback_data:",n.callback_data),n.session_data&&console.log("üîç Contenu de session_data:",n.session_data),n.user_data_sent&&console.log("üîç Contenu de user_data_sent:",n.user_data_sent);var r={token:n.callback_data&&n.callback_data.jwt||n.jwt_token||n.token||n.auth_token||n.callback_data&&n.callback_data.token||n.session_data&&n.session_data.token||n.user_data_sent&&n.user_data_sent.token,session_id:n.session_id||n.sessionId||n.session||n.callback_data&&n.callback_data.session_id||n.session_data&&n.session_data.session_id,user_id:n.user_id||n.userId||n.user,partner_id:n.partner_id||n.partnerId||n.partner,type:n.type,timestamp:n.timestamp||t.timestamp||e.timestamp,signature:n.signature||n.callback_data&&n.callback_data.signature,user_info:n.user_info||n.userInfo||n.user_data||n.user_data_sent&&n.user_data_sent.user_info||n.session_data&&n.session_data.user_info,redirect_url:n.redirect_url||n.redirectUrl||n.redirect||n.session_data&&n.session_data.redirect_url};return console.log("üìã Donn√©es d'authentification extraites:",r),r}if(e.data){console.log("‚úÖ Format WebSocket d√©tect√©, extraction directe de data"),console.log("üîç Contenu complet de data:",e.data),console.log("üîç Cl√©s disponibles dans data:",Object.keys(e.data));var o=e.data;o.callback_data&&console.log("üîç Contenu de callback_data:",o.callback_data),o.session_data&&console.log("üîç Contenu de session_data:",o.session_data),o.user_data_sent&&console.log("üîç Contenu de user_data_sent:",o.user_data_sent);var i={token:o.callback_data&&o.callback_data.jwt||o.jwt_token||o.token||o.auth_token||o.callback_data&&o.callback_data.token||o.session_data&&o.session_data.token||o.user_data_sent&&o.user_data_sent.token,session_id:o.session_id||o.sessionId||o.session||o.callback_data&&o.callback_data.session_id||o.session_data&&o.session_data.session_id,user_id:o.user_id||o.userId||o.user,partner_id:o.partner_id||o.partnerId||o.partner,type:o.type,timestamp:o.timestamp||e.timestamp,signature:o.signature||o.callback_data&&o.callback_data.signature,user_info:o.user_info||o.userInfo||o.user_data||o.user_data_sent&&o.user_data_sent.user_info||o.session_data&&o.session_data.user_info,redirect_url:o.redirect_url||o.redirectUrl||o.redirect||o.session_data&&o.session_data.redirect_url};return console.log("üìã Donn√©es d'authentification extraites:",i),i}return console.log("‚ö†Ô∏è Format non reconnu, tentative d'extraction directe"),{token:e.token||e.auth_token,session_id:e.session_id||e.sessionId,user_id:e.user_id||e.userId,partner_id:e.partner_id||e.partnerId,type:e.type,timestamp:e.timestamp,signature:e.signature,user_info:e.user_info||e.userInfo,redirect_url:e.redirect_url||e.redirectUrl}}},{key:"showSuccessMessage",value:function(e){console.log("‚úÖ Affichage du message de succ√®s");for(var t=null,n=0,r=["qr-area","qr-container","sunuid-qr-container"];n<r.length;n++){var o=r[n];if(t=document.getElementById(o))break}if(t){var i=e.user_info||{},s=i.name||i.username||"Utilisateur",a=i.email||"";t.innerHTML='\n                <div style="\n                    text-align: center;\n                    padding: 40px 20px;\n                    background: #d4edda;\n                    border: 2px solid #28a745;\n                    border-radius: 10px;\n                    color: #155724;\n                    font-family: Arial, sans-serif;\n                ">\n                    <div style="\n                        width: 60px;\n                        height: 60px;\n                        background: #28a745;\n                        border-radius: 50%;\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        margin: 0 auto 20px auto;\n                        font-size: 30px;\n                        color: white;\n                    ">‚úÖ</div>\n                    <h3 style="margin: 0 0 10px 0; color: #155724;">üéâ Authentification r√©ussie !</h3>\n                    <p style="margin: 0 0 15px 0; font-size: 16px; font-weight: bold;">\n                        Bienvenue, '.concat(s," !\n                    </p>\n                    ").concat(a?'<p style="margin: 0 0 15px 0; font-size: 14px; color: #6c757d;">'.concat(a,"</p>"):"",'\n                    <p style="margin: 0; font-size: 14px;">\n                        Votre identit√© a √©t√© v√©rifi√©e avec succ√®s.\n                    </p>\n                    <div style="margin-top: 20px; font-size: 12px; color: #6c757d;">\n                        üîÑ Redirection en cours...\n                    </div>\n                </div>\n            '),console.log("‚úÖ Message de succ√®s affich√©")}else console.warn("‚ö†Ô∏è Conteneur QR non trouv√© pour afficher le message de succ√®s")}},{key:"handleCallback",value:function(){var t=new URLSearchParams(e.location.search);if(t.has("token")&&t.has("session_id")){console.log("üîó Callback SunuID d√©tect√©");var n={token:t.get("token"),state:t.get("state"),session_id:t.get("session_id"),user_id:t.get("user_id"),partner_id:t.get("partner_id"),type:t.get("type"),timestamp:t.get("timestamp"),signature:t.get("signature")};return console.log("üìã Donn√©es callback:",n),this.validateCallback(n),this.processAuthentication(n),!0}return!1}},{key:"validateCallback",value:function(e){if(console.log("üîí Validation du callback..."),e.state&&e.state!==this.config.state)throw console.error("‚ùå √âtat de s√©curit√© invalide"),new Error("√âtat de s√©curit√© invalide");if(e.signature&&this.config.verifySignature&&!this.verifySignature(e))throw console.error("‚ùå Signature invalide"),new Error("Signature invalide");if(e.timestamp&&this.isExpired(e.timestamp))throw console.error("‚ùå Token expir√©"),new Error("Token expir√©");console.log("‚úÖ Callback valid√© avec succ√®s")}},{key:"processAuthentication",value:function(e){console.log("üîê Traitement de l'authentification...");try{var t=this.decodeJWT(e.token),n={user_id:t.user_id||e.user_id,session_id:t.session_id||e.session_id,partner_id:t.partner_id||e.partner_id,type:t.type||e.type,iat:t.iat,exp:t.exp};console.log("üë§ Donn√©es utilisateur:",n),this.emitWebSocketEvent("authentication_success",{userData:n,callbackData:e,timestamp:Date.now()}),this.config.onAuthenticationSuccess&&this.config.onAuthenticationSuccess(n,e),this.config.redirectAfterSuccess&&this.redirectAfterSuccess(n),console.log("‚úÖ Authentification trait√©e avec succ√®s")}catch(t){throw console.error("‚ùå Erreur lors du traitement:",t),this.config.onAuthenticationError&&this.config.onAuthenticationError(t,e),t}}},{key:"decodeJWT",value:function(e){try{var t=e.split(".");if(3!==t.length)throw new Error("Format JWT invalide");var n=t[1];return JSON.parse(atob(n))}catch(e){throw console.error("‚ùå Erreur d√©codage JWT:",e),new Error("Token JWT invalide")}}},{key:"verifySignature",value:function(e){var t=this.generateSignature(e);return e.signature===t}},{key:"generateSignature",value:function(e){var t="".concat(e.token,".").concat(e.state,".").concat(e.session_id,".").concat(e.timestamp);return btoa(t).slice(0,12)}},{key:"isExpired",value:function(e){return Math.floor(Date.now()/1e3)-parseInt(e)>(this.config.tokenMaxAge||300)}},{key:"redirectAfterSuccess",value:function(t){var n=this.config.redirectAfterSuccess;n=n.replace("{user_id}",t.user_id).replace("{session_id}",t.session_id).replace("{partner_id}",t.partner_id).replace("{type}",t.type),console.log("üîÑ Redirection vers:",n),setTimeout(function(){e.location.href=n},100)}},{key:"generateState",value:function(){var e="sunuid_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);return this.config.state=e,e}}],o&&r(t.prototype,o),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,o,i,d,p,h,g,v,y,m,b,k,S,I,_,w,R,E,x,C,Q,T,D,q}();e.SunuID=d,e.sunuidInstance=null,e.initSunuID=function(t){try{return e.sunuidInstance=new d(t),e.sunuidInstance}catch(e){throw console.error("Erreur lors de l'initialisation de SunuID:",e),e}}}(window)}();
//# sourceMappingURL=sunuid-sdk.min.js.map
