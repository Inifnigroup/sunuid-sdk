!function(){"use strict";function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function t(e,t,n,i,r,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(i,r)}function n(e){return function(){var n=this,i=arguments;return new Promise(function(r,o){var s=e.apply(n,i);function a(e){t(s,r,o,a,c,"next",e)}function c(e){t(s,r,o,a,c,"throw",e)}a(void 0)})}}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,d(i.key),i)}}function r(e,t,n){return(t=d(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function a(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var e,t,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",r=n.toStringTag||"@@toStringTag";function o(n,i,r,o){var a=i&&i.prototype instanceof u?i:u,l=Object.create(a.prototype);return c(l,"_invoke",function(n,i,r){var o,a,c,u=0,l=r||[],d=!1,f={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return o=t,a=0,c=e,f.n=n,s}};function p(n,i){for(a=n,c=i,t=0;!d&&u&&!r&&t<l.length;t++){var r,o=l[t],p=f.p,h=o[2];n>3?(r=h===i)&&(c=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=e):o[0]<=p&&((r=n<2&&p<o[1])?(a=0,f.v=i,f.n=o[1]):p<h&&(r=n<3||o[0]>i||i>h)&&(o[4]=n,o[5]=i,f.n=h,a=0))}if(r||n>1)return s;throw d=!0,i}return function(r,l,h){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,h),a=l,c=h;(t=a<2?e:c)||!d;){o||(a?a<3?(a>1&&(f.n=-1),p(a,c)):f.n=c:f.v=c);try{if(u=2,o){if(a||(r="next"),t=o[r]){if(!(t=t.call(o,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=o.return)&&t.call(o),a<2&&(c=TypeError("The iterator does not provide a '"+r+"' method"),a=1);o=e}else if((t=(d=f.n<0)?c:n.call(i,f))!==s)break}catch(t){o=e,a=1,c=t}finally{u=1}}return{value:t,done:d}}}(n,r,o),!0),l}var s={};function u(){}function l(){}function d(){}t=Object.getPrototypeOf;var f=[][i]?t(t([][i]())):(c(t={},i,function(){return this}),t),p=d.prototype=u.prototype=Object.create(f);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,c(e,r,"GeneratorFunction")),e.prototype=Object.create(p),e}return l.prototype=d,c(p,"constructor",d),c(d,"constructor",l),l.displayName="GeneratorFunction",c(d,r,"GeneratorFunction"),c(p),c(p,r,"Generator"),c(p,i,function(){return this}),c(p,"toString",function(){return"[object Generator]"}),(a=function(){return{w:o,m:h}})()}function c(e,t,n,i){var r=Object.defineProperty;try{r({},"",{})}catch(e){r=0}c=function(e,t,n,i){function o(t,n){c(e,t,function(e){return this._invoke(t,n,e)})}t?r?r(e,t,{value:n,enumerable:!i,configurable:!i,writable:!i}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},c(e,t,n,i)}function u(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(typeof e+" is not iterable")}function l(t,n){return function(e){if(Array.isArray(e))return e}(t)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);c=!0);}catch(e){u=!0,r=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw r}}return a}}(t,n)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?e(t,n):void 0}}
/**
   * SunuID SDK - Package d'int√©gration pour partenaires
   * 
   * @version 1.0.0
   * @author SunuID Team
   * @license MIT
   */(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}!function(e,t){var r={apiUrl:(null===(t=e.SunuIDConfig)||void 0===t?void 0:t.apiUrl)||"https://api.sunuid.fayma.sn",clientId:null,secretId:null,type:2,partnerName:"SunuID",theme:"light",language:"fr",autoRefresh:!0,refreshInterval:3e4,onSuccess:null,onError:null,onStatusUpdate:null,onExpired:null,enableSecurityLogs:!0,validateInputs:!0,maxRetries:3,requestTimeout:1e4,secureInit:!1,secureInitUrl:"http://localhost:8081/secure-init.php",token:null},o=function(){return t=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=s(s({},r),t),this.qrCode=null,this.refreshTimer=null,this.isInitialized=!1,this.socket=null,this.initPromise=this.init()},o=[{key:"init",value:(k=n(a().m(function e(){var t;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=0,!this.config.secureInit){e.n=2;break}return e.n=1,this.secureInit();case 1:e.n=3;break;case 2:this.config.validateInputs&&this.validateSecurityParams();case 3:this.logSecurityEvent("SDK_INIT_START",{apiUrl:this.config.apiUrl,type:this.config.type,partnerName:this.config.partnerName,secureInit:this.config.secureInit}),this.obfuscateCredentials(),this.isInitialized=!0,console.log("SunuID SDK initialis√© avec succ√®s"),this.logSecurityEvent("SDK_INIT_SUCCESS"),this.initWebSocket(),e.n=5;break;case 4:throw e.p=4,t=e.v,this.logSecurityEvent("SDK_INIT_ERROR",{error:t.message}),t;case 5:return e.a(2)}},e,this,[[0,4]])})),function(){return k.apply(this,arguments)})},{key:"secureInit",value:(b=n(a().m(function e(){var t,n,i,r,o;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,this.logSecurityEvent("SECURE_INIT_START"),t={type:this.config.type,partnerName:this.config.partnerName,theme:this.config.theme},e.n=1,fetch(this.config.secureInitUrl,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)});case 1:if((n=e.v).ok){e.n=2;break}throw new Error("Erreur HTTP: ".concat(n.status));case 2:return e.n=3,n.json();case 3:if((i=e.v).success){e.n=4;break}throw new Error(i.error||"Erreur lors de l'initialisation s√©curis√©e");case 4:if(this.config.token=i.data.token,this.config.apiUrl=i.data.api_url,!(r=this.decodeSecureToken(i.data.token))){e.n=5;break}this.config.clientId=r.client_id,this.config.secretId=r.secret_id,e.n=6;break;case 5:throw new Error("Impossible de d√©coder le token s√©curis√©");case 6:this.config.expiresIn=i.data.expires_in,this.config.maxRequests=i.data.max_requests,this.config.requestCount=0,this.logSecurityEvent("SECURE_INIT_SUCCESS",{expiresIn:i.data.expires_in,maxRequests:i.data.max_requests}),console.log("‚úÖ Initialisation s√©curis√©e r√©ussie"),e.n=8;break;case 7:throw e.p=7,o=e.v,this.logSecurityEvent("SECURE_INIT_ERROR",{error:o.message}),new Error("√âchec de l'initialisation s√©curis√©e: ".concat(o.message));case 8:return e.a(2)}},e,this,[[0,7]])})),function(){return b.apply(this,arguments)})},{key:"decodeSecureToken",value:function(e){try{var t=e.split(".");if(2!==t.length)return console.error("‚ùå Format de token invalide"),null;var n=l(t,2),i=n[0],r=(n[1],atob(i)),o=JSON.parse(r);return o.exp&&o.exp<Date.now()/1e3?(console.error("‚ùå Token expir√©"),null):(console.log("‚úÖ Token d√©cod√© avec succ√®s"),o)}catch(e){return console.error("‚ùå Erreur d√©codage token:",e),null}}},{key:"initWebSocket",value:function(){var e=this;try{if("undefined"==typeof io)return console.warn("‚ö†Ô∏è Socket.IO non disponible, WebSocket sera initialis√© plus tard"),void setTimeout(function(){return e.initWebSocket()},1e3);var t=this.getClientIP();this.socket||(this.socket=io("wss://samasocket.fayma.sn:9443",{query:{token:this.config.clientId,type:"web",userId:this.config.clientId,username:t}}),this.socket.on("connect",function(){console.log("üåê WebSocket connect√© avec succ√®s"),console.log("üìä Socket ID:",e.socket.id)}),this.socket.on("disconnect",function(e){console.log("‚ùå WebSocket d√©connect√©:",e)}),this.socket.on("connect_error",function(e){console.error("‚ùå Erreur connexion WebSocket:",e)}),this.socket.on("qr_status_update",function(t){console.log("üì± Mise √† jour statut QR re√ßue:",t),e.handleQRStatusUpdate(t)}),this.socket.on("qr_scan_success",function(t){console.log("‚úÖ Scan QR r√©ussi re√ßu:",t),e.handleQRScanSuccess(t)}),this.socket.on("qr_expired",function(t){console.log("‚è∞ QR expir√© re√ßu:",t),e.handleQRExpired(t)}))}catch(e){console.error("‚ùå Erreur initialisation WebSocket:",e)}}},{key:"getClientIP",value:function(){return"127.0.0.1"}},{key:"getTypeName",value:function(e){switch(e){case 1:return"KYC";case 2:return"AUTH";case 3:return"SIGNATURE";default:return"TYPE-".concat(e)}}},{key:"validateSecurityParams",value:function(){var e=[];if(this.config.clientId&&"string"==typeof this.config.clientId?this.config.clientId.length<10&&e.push("clientId trop court"):e.push("clientId invalide ou manquant"),this.config.secretId&&"string"==typeof this.config.secretId?this.config.secretId.length<32&&e.push("secretId trop court (minimum 32 caract√®res)"):e.push("secretId invalide ou manquant"),this.config.apiUrl&&this.isValidUrl(this.config.apiUrl)||e.push("apiUrl invalide"),[1,2,3].includes(this.config.type)||e.push("type invalide (doit √™tre 1, 2 ou 3)"),e.length>0)throw this.logSecurityEvent("VALIDATION_ERROR",{errors:e}),new Error("Param√®tres de s√©curit√© invalides: ".concat(e.join(", ")));this.logSecurityEvent("VALIDATION_SUCCESS")}},{key:"isValidUrl",value:function(e){try{var t=new URL(e);return"https:"===t.protocol||"http:"===t.protocol}catch(e){return!1}}},{key:"logSecurityEvent",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.config.enableSecurityLogs){var i={timestamp:(new Date).toISOString(),event:t,data:n,userAgent:navigator.userAgent,url:e.location.href};console.warn("üîí [SECURITY]",i),e.SunuIDSecurityLogs||(e.SunuIDSecurityLogs=[]),e.SunuIDSecurityLogs.push(i)}}},{key:"obfuscateCredentials",value:function(){this.config.originalClientId=this.config.clientId,this.config.originalSecretId=this.config.secretId,this.config.clientId&&(this.config.clientIdDisplay=this.config.clientId.replace(/(.{3}).*(.{3})/,"$1***$2")),this.config.secretId&&(this.config.secretIdDisplay=this.config.secretId.replace(/(.{4}).*(.{4})/,"$1***$2"))}},{key:"sanitizeInput",value:function(e){return"string"!=typeof e?e:e.replace(/[<>]/g,"").replace(/javascript:/gi,"").trim()}},{key:"handleQRStatusUpdate",value:function(e){this.config.onStatusUpdate&&this.config.onStatusUpdate(e)}},{key:"handleQRScanSuccess",value:function(e){this.config.onSuccess&&this.config.onSuccess(e)}},{key:"handleQRExpired",value:function(e){this.config.onExpired&&this.config.onExpired(e)}},{key:"emitWebSocketEvent",value:function(e,t){this.socket&&this.socket.connected?(this.socket.emit(e,t),console.log("üì§ √âv√©nement WebSocket √©mis: ".concat(e),t)):"undefined"==typeof io?console.warn("‚ö†Ô∏è Socket.IO non disponible, impossible d'√©mettre l'√©v√©nement:",e):console.warn("‚ö†Ô∏è WebSocket non connect√©, impossible d'√©mettre l'√©v√©nement:",e)}},{key:"getWebSocketStatus",value:function(){return this.socket?this.socket.connected?"connected":"disconnected":"not_initialized"}},{key:"forceWebSocketInit",value:function(){"undefined"==typeof io||this.socket||(console.log("üîÑ For√ßage de l'initialisation WebSocket..."),this.initWebSocket())}},{key:"generateQR",value:(I=n(a().m(function e(t){var n,i,r,o,c,u=this,l=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:{},!this.initPromise){e.n=2;break}return e.n=1,this.initPromise;case 1:this.initPromise=null;case 2:if(this.isInitialized){e.n=3;break}throw new Error("SunuID: SDK non initialis√©");case 3:return e.p=3,e.n=4,this.makeRequest("/qr-generate",s({type:this.config.type},n));case 4:if(!(i=e.v).success){e.n=5;break}return r="".concat("https://sunuid.fayma.sn").concat(i.data.qrcode),this.currentQRUrl=r,this.displayQRCode(t,r,this.config.type,n),this.pendingQRInfo&&i.data.code&&(o=function(){if(u.socket&&u.socket.id&&"unknown"!==u.socket.id){var e=u.socket.id,t="".concat(u.config.type,"-").concat(i.data.code,"-").concat(e),n=i.data.partnerName||u.config.partnerName||"SunuID",r=u.getTypeName(u.config.type),s="".concat(r," - ").concat(n);u.generateCustomQRCode(t,s,u.pendingQRInfo.options),u.pendingQRInfo=null}else setTimeout(o,100)})(),this.startAutoRefresh(t,this.config.type,n),this.emitWebSocketEvent("qr_generated",{serviceId:i.data.service_id,type:this.config.type,qrCodeUrl:r,code:i.data.code,timestamp:Date.now()}),e.a(2,s(s({},i.data),{},{qrCodeUrl:r,sessionId:i.data.service_id}));case 5:throw new Error(i.message||"Erreur lors de la g√©n√©ration du QR code");case 6:e.n=8;break;case 7:throw e.p=7,c=e.v,console.error("Erreur API d√©tect√©e:",c.message),console.error("Stack trace complet:",c.stack),console.error("Configuration SDK:",{apiUrl:this.config.apiUrl,type:this.config.type,secureInit:this.config.secureInit,clientId:this.config.clientId?"***"+this.config.clientId.slice(-4):"null",secretId:this.config.secretId?"***"+this.config.secretId.slice(-4):"null"}),console.log('Affichage du message "Service non disponible" pour type '+this.config.type),this.displayServiceUnavailable(t,this.config.type),new Error("Service non disponible");case 8:return e.a(2)}},e,this,[[3,7]])})),function(e){return I.apply(this,arguments)})},{key:"generateCustomQR",value:(S=n(a().m(function e(t,n){var i,r,o,c,u,l=this,d=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(i=d.length>2&&void 0!==d[2]?d[2]:{},!this.initPromise){e.n=2;break}return e.n=1,this.initPromise;case 1:this.initPromise=null;case 2:if(this.isInitialized){e.n=3;break}throw new Error("SunuID: SDK non initialis√©");case 3:return e.p=3,e.n=4,this.makeRequest("/qr-generate",s({type:n},i));case 4:if(!(r=e.v).success){e.n=5;break}return o="".concat("https://sunuid.fayma.sn").concat(r.data.qrcode),this.displayQRCode(t,o,n,i),this.pendingQRInfo&&r.data.code&&(c=function(){if(l.socket&&l.socket.id&&"unknown"!==l.socket.id){var e=l.socket.id,t="".concat(n,"-").concat(r.data.code,"-").concat(e),i=r.data.partnerName||l.config.partnerName||"SunuID",o=l.getTypeName(n),s="".concat(o," - ").concat(i);l.generateCustomQRCode(t,s,l.pendingQRInfo.options),l.pendingQRInfo=null}else setTimeout(c,100)})(),this.startAutoRefresh(t,n,i),e.a(2,s(s({},r.data),{},{qrCodeUrl:o,sessionId:r.data.service_id}));case 5:throw new Error(r.message||"Erreur lors de la g√©n√©ration du QR code");case 6:e.n=8;break;case 7:throw e.p=7,u=e.v,console.error("Erreur API d√©tect√©e:",u.message),console.error("Stack trace complet:",u.stack),console.error("Configuration SDK (Custom):",{apiUrl:this.config.apiUrl,type:n,secureInit:this.config.secureInit,clientId:this.config.clientId?"***"+this.config.clientId.slice(-4):"null",secretId:this.config.secretId?"***"+this.config.secretId.slice(-4):"null"}),console.log('Affichage du message "Service non disponible" pour type '+n),this.displayServiceUnavailable(t,n),new Error("Service non disponible");case 8:return e.a(2)}},e,this,[[3,7]])})),function(e,t){return S.apply(this,arguments)})},{key:"generateAuthQR",value:(m=n(a().m(function e(t){var n,i=arguments;return a().w(function(e){for(;;)if(0===e.n)return n=i.length>1&&void 0!==i[1]?i[1]:{},e.a(2,this.generateQR(t,n))},e,this)})),function(e){return m.apply(this,arguments)})},{key:"generateKYCQR",value:(v=n(a().m(function e(t){var n,i,r=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},i=this.config.type,this.config.type=1,e.p=1,e.n=2,this.generateQR(t,n);case 2:return e.a(2,e.v);case 3:return e.p=3,this.config.type=i,e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])})),function(e){return v.apply(this,arguments)})},{key:"generateSignatureQR",value:(y=n(a().m(function e(t){var n,i,r=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},i=this.config.type,this.config.type=3,e.p=1,e.n=2,this.generateQR(t,n);case 2:return e.a(2,e.v);case 3:return e.p=3,this.config.type=i,e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])})),function(e){return y.apply(this,arguments)})},{key:"checkQRStatus",value:(g=n(a().m(function e(t){var n,i;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.isInitialized){e.n=1;break}throw new Error("SunuID: SDK non initialis√©");case 1:return e.p=1,e.n=2,this.makeRequest("/qr-status",{serviceId:t});case 2:if(!(n=e.v).success){e.n=3;break}return e.a(2,n.data);case 3:throw new Error(n.message||"Erreur lors de la v√©rification du statut");case 4:e.n=6;break;case 5:throw e.p=5,i=e.v,this.handleError(i),i;case 6:return e.a(2)}},e,this,[[1,5]])})),function(e){return g.apply(this,arguments)})},{key:"displayQRCode",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=document.getElementById(e);if(!r)throw new Error("Conteneur avec l'ID \"".concat(e,'" non trouv√©'));r.innerHTML="";var o=document.createElement("div");o.className="sunuid-qr-code",this.getTypeName(n),o.innerHTML='\n                <div class="sunuid-qr-header">\n                    <h3>'.concat(1===n?"V√©rification KYC":2===n?"Authentification":3===n?"Signature":"Service Type "+n,'</h3>\n                </div>\n                <div class="sunuid-qr-image" id="sunuid-qr-container">\n                    <div style="text-align: center; padding: 40px;">\n                        <div class="sunuid-loader">\n                            <div class="sunuid-spinner"></div>\n                            <p style="margin-top: 20px; color: #666;">Initialisation en cours...</p>\n                            <p style="font-size: 12px; color: #999; margin-top: 10px;">Connexion API et WebSocket</p>\n                            <p style="font-size: 11px; color: #ccc; margin-top: 5px;">Attente du Socket ID...</p>\n                        </div>\n                    </div>\n                </div>\n                <div class="sunuid-qr-instructions" style="display: none;">\n                    <p>Scannez ce QR code avec l\'application SunuID pour vous connecter</p>\n                </div>\n                <div class="sunuid-qr-status" id="sunuid-status" style="display: none;">\n                    <p>En attente de scan...</p>\n                </div>\n            '),r.appendChild(o),this.pendingQRInfo={containerId:e,type:n,options:i},this.applyTheme(i.theme||this.config.theme)}},{key:"generateCustomQRCode",value:(h=n(a().m(function e(t,n){var i,r,o,s,c,u;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:if(e.p=1,console.log("üé® D√©but g√©n√©ration QR personnalis√© avec PHP..."),console.log("üìÑ Contenu:",t),console.log("üè∑Ô∏è Label:",n),i=document.getElementById("sunuid-qr-container")){e.n=2;break}return console.error("‚ùå QR container not found"),this.displayFallbackImage(),e.a(2);case 2:return console.log("‚úÖ QR container trouv√©"),i.innerHTML='<div style="text-align: center; padding: 20px;"><p>G√©n√©ration QR code avec PHP...</p></div>',console.log("üîÑ Appel endpoint PHP..."),e.n=3,fetch("http://localhost:8081/qr-generator.php",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({content:t,label:n,size:300,margin:10})});case 3:if(r=e.v,console.log("üì• R√©ponse PHP re√ßue - Status:",r.status),r.ok){e.n=4;break}throw new Error("Erreur HTTP: ".concat(r.status));case 4:return e.n=5,r.json();case 5:if((o=e.v).success){e.n=6;break}throw new Error("Erreur PHP: ".concat(o.error));case 6:console.log("‚úÖ QR code g√©n√©r√© par PHP avec succ√®s"),console.log("üìä Taille:",o.data.size+"px"),console.log("üìä Longueur base64:",o.data.length+" caract√®res"),this.currentQRUrl=o.data.dataUrl,i.innerHTML='\n                    <div class="sunuid-qr-ready" style="text-align: center; padding: 20px;">\n                        <img src="'.concat(o.data.dataUrl,'" alt="QR Code SunuID" style="max-width: 300px; border: 2px solid #ddd; border-radius: 10px;">\n                    </div>\n                '),s=i.parentElement.querySelector(".sunuid-qr-instructions"),c=i.parentElement.querySelector(".sunuid-qr-status"),s&&(s.style.display="block",s.classList.add("sunuid-qr-ready")),c&&(c.style.display="block",c.classList.add("sunuid-qr-ready")),console.log("‚úÖ QR code PHP affich√© dans le conteneur"),e.n=8;break;case 7:e.p=7,u=e.v,console.error("‚ùå Erreur g√©n√©ration QR PHP:",u),console.error("Stack trace:",u.stack),this.displayFallbackImage();case 8:return e.a(2)}},e,this,[[1,7]])})),function(e,t){return h.apply(this,arguments)})},{key:"addLogoToCenter",value:function(e,t,n,i,r){try{var o=new Image;o.onload=function(){var r=40,s=t+(i-r)/2,a=n+(i-r)/2;e.fillStyle="white",e.fillRect(s-2,a-2,44,44),e.drawImage(o,s,a,r,r)},o.src="src/logoqr.png"}catch(e){console.warn("Logo non disponible:",e)}}},{key:"displayFallbackImage",value:function(){console.log("‚ö†Ô∏è Affichage de l'image de fallback");var e=document.getElementById("sunuid-qr-container");e?e.innerHTML='\n                    <div style="text-align: center; padding: 20px; color: #666;">\n                        <p>‚ö†Ô∏è G√©n√©ration QR personnalis√© non disponible</p>\n                        <p>Utilisation de l\'image par d√©faut</p>\n                        <p><strong>Debug:</strong> QRCode disponible: '.concat("undefined"!=typeof QRCode,"</p>\n                        <p><strong>Debug:</strong> Container trouv√©: ").concat(null!==e,"</p>\n                    </div>\n                "):console.error("‚ùå Container QR non trouv√© pour fallback")}},{key:"displayServiceUnavailable",value:function(e,t){console.log("displayServiceUnavailable appel√©e pour ".concat(e,", type: ").concat(t));var n=document.getElementById(e);n?n.innerHTML='\n                <div class="sunuid-service-unavailable" style="\n                    text-align: center;\n                    padding: 40px 20px;\n                    background: #f8f9fa;\n                    border: 2px dashed #dee2e6;\n                    border-radius: 10px;\n                    color: #6c757d;\n                    font-family: Arial, sans-serif;\n                ">\n                    <div style="font-size: 48px; margin-bottom: 20px;">‚ö†Ô∏è</div>\n                    <h3 style="margin: 0 0 10px 0; color: #495057;">Service Non Disponible</h3>\n                    <p style="margin: 0; font-size: 14px;">\n                        Le service d\'authentification est temporairement indisponible.<br>\n                        Veuillez r√©essayer plus tard.\n                    </p>\n                    <div style="margin-top: 20px; font-size: 12px; color: #adb5bd;">\n                        Type: '.concat(String(t).toUpperCase(),"\n                    </div>\n                </div>\n            "):console.error("Container ".concat(e," non trouv√©"))}},{key:"refreshQR",value:(p=n(a().m(function e(t){var n,i,r,o=arguments;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},e.p=1,e.n=2,this.generateQR(t,n);case 2:return i=e.v,e.a(2,i);case 3:throw e.p=3,r=e.v,console.error("Erreur lors du rafra√Æchissement:",r.message),this.displayServiceUnavailable(t,this.config.type),r;case 4:return e.a(2)}},e,this,[[1,3]])})),function(e){return p.apply(this,arguments)})},{key:"startAutoRefresh",value:function(e,t,i){var r=this;this.config.autoRefresh&&(this.refreshTimer=setInterval(n(a().m(function n(){var o;return a().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,r.refreshQR(e,t,i);case 1:n.n=3;break;case 2:n.p=2,o=n.v,console.warn("Erreur lors du rafra√Æchissement automatique:",o);case 3:return n.a(2)}},n,null,[[0,2]])})),this.config.refreshInterval))}},{key:"makeRequest",value:(d=n(a().m(function t(n,i){var r,o,s,c,l,d,f,p,h,g=this;return a().w(function(t){for(;;)switch(t.n){case 0:if(this.isInitialized){t.n=1;break}throw this.logSecurityEvent("REQUEST_BEFORE_INIT",{endpoint:n}),new Error("SDK non initialis√©");case 1:if(!this.config.secureInit){t.n=2;break}if(this.config.requestCount++,!(this.config.requestCount>this.config.maxRequests)){t.n=2;break}throw this.logSecurityEvent("API_REQUEST_LIMIT_EXCEEDED",{requestCount:this.config.requestCount,maxRequests:this.config.maxRequests}),new Error("Limite de requ√™tes d√©pass√©e");case 2:s=this.sanitizeRequestData(i),console.log("üîç Debug makeRequest - endpoint:",n),console.log("üîç Debug makeRequest - apiUrl:",this.config.apiUrl),console.log("üîç Debug makeRequest - url:","".concat(this.config.apiUrl).concat(n)),console.log("üîç Debug makeRequest - data:",JSON.stringify(s,null,2)),console.log("üîç Debug makeRequest - secureInit:",this.config.secureInit),console.log("üîç Debug makeRequest - isInitialized:",this.isInitialized),c=(null===(r=e.SunuIDConfig)||void 0===r||null===(r=r.endpoints)||void 0===r?void 0:r[n.replace("/","")])||n,l="".concat(this.config.apiUrl).concat(c),console.log("üîç URL finale construite:",l),console.log("üîç EndpointPath:",c),console.log("üîç SunuIDConfig endpoints:",JSON.stringify(null===(o=e.SunuIDConfig)||void 0===o?void 0:o.endpoints)),this.logSecurityEvent("API_REQUEST_START",{endpoint:c,url:l,dataKeys:Object.keys(s),secureInit:this.config.secureInit}),d=0,f=this.config.maxRetries,p=a().m(function e(){var t,n,i,r,o,u,p,h;return a().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,t=new AbortController,n=setTimeout(function(){return t.abort()},g.config.requestTimeout),i={"Content-Type":"application/json"},e.n=1,fetch(l,{method:"POST",headers:i,body:JSON.stringify(s),signal:t.signal});case 1:if(r=e.v,clearTimeout(n),r.ok){e.n=3;break}return e.n=2,r.text();case 2:o=e.v;try{u=JSON.parse(o)}catch(e){u={message:o}}throw g.logSecurityEvent("API_REQUEST_ERROR",{status:r.status,statusText:r.statusText,error:u.message}),new Error(u.message||"Erreur HTTP: ".concat(r.status));case 3:return e.n=4,r.json();case 4:return p=e.v,g.logSecurityEvent("API_REQUEST_SUCCESS",{endpoint:c,responseKeys:Object.keys(p)}),e.a(2,{v:p});case 5:if(e.p=5,h=e.v,d++,"AbortError"!==h.name){e.n=7;break}if(g.logSecurityEvent("API_REQUEST_TIMEOUT",{retryCount:d}),!(d>f)){e.n=6;break}throw new Error("Timeout de la requ√™te API");case 6:return e.a(2,0);case 7:if(!(d>f)){e.n=8;break}throw g.logSecurityEvent("API_REQUEST_MAX_RETRIES",{retryCount:d,error:h.message}),h;case 8:return e.n=9,new Promise(function(e){return setTimeout(e,1e3*d)});case 9:return e.a(2)}},e,null,[[0,5]])});case 3:if(!(d<=f)){t.n=7;break}return t.d(u(p()),4);case 4:if(0!==(h=t.v)){t.n=5;break}return t.a(3,3);case 5:if(!h){t.n=6;break}return t.a(2,h.v);case 6:t.n=3;break;case 7:return t.a(2)}},t,this)})),function(e,t){return d.apply(this,arguments)})},{key:"sanitizeRequestData",value:function(e){for(var t={},n=0,i=Object.entries(e);n<i.length;n++){var r=l(i[n],2),o=r[0],s=r[1];"string"==typeof s?t[o]=this.sanitizeInput(s):"object"===f(s)&&null!==s?t[o]=this.sanitizeRequestData(s):t[o]=s}return t.client_id=this.config.originalClientId||this.config.clientId,t.secret_id=this.config.originalSecretId||this.config.secretId,console.log("üîç Credentials dans sanitizeRequestData - clientId:",this.config.clientId),console.log("üîç Credentials dans sanitizeRequestData - secretId:",this.config.secretId?"***"+this.config.secretId.slice(-4):"null"),console.log("üîç Credentials dans sanitizeRequestData - sanitizedClientId:",t.client_id),console.log("üîç Credentials dans sanitizeRequestData - sanitizedSecretId:",t.secret_id?"***"+t.secret_id.slice(-4):"null"),console.log("üîç Credentials dans sanitizeRequestData - data complet:",JSON.stringify(t,null,2)),console.log("üîç Credentials dans sanitizeRequestData - clientId:",this.config.clientId),console.log("üîç Credentials dans sanitizeRequestData - secretId:",this.config.secretId?"***"+this.config.secretId.slice(-4):"null"),console.log("üîç Credentials dans sanitizeRequestData - sanitizedClientId:",t.client_id),console.log("üîç Credentials dans sanitizeRequestData - sanitizedSecretId:",t.secret_id?"***"+t.secret_id.slice(-4):"null"),console.log("üîç Credentials dans sanitizeRequestData - data complet:",JSON.stringify(t,null,2)),t}},{key:"generateRequestId",value:function(){return"req_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}},{key:"applyTheme",value:function(e){var t=document.querySelector(".sunuid-qr-code");t&&(t.className="sunuid-qr-code sunuid-theme-".concat(e))}},{key:"handleError",value:function(e){console.error("SunuID SDK Error:",e),this.config.onError&&this.config.onError(e)}},{key:"getQRCode",value:function(){return this.currentQRUrl?this.currentQRUrl:null}},{key:"destroy",value:function(){this.refreshTimer&&clearInterval(this.refreshTimer),this.socket&&(this.socket.disconnect(),this.socket=null,console.log("üåê WebSocket d√©connect√©")),this.isInitialized=!1,this.logSecurityEvent("SDK_DESTROY"),console.log("SunuID SDK d√©truit")}},{key:"getSecurityLogs",value:function(){return e.SunuIDSecurityLogs||[]}},{key:"clearSecurityLogs",value:function(){e.SunuIDSecurityLogs=[],this.logSecurityEvent("SECURITY_LOGS_CLEARED")}}],o&&i(t.prototype,o),c&&i(t,c),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,o,c,d,p,h,g,y,v,m,S,I,b,k}();e.SunuID=o,e.sunuidInstance=null,e.initSunuID=function(t){try{return e.sunuidInstance=new o(t),e.sunuidInstance}catch(e){throw console.error("Erreur lors de l'initialisation de SunuID:",e),e}}}(window)}();
//# sourceMappingURL=sunuid-sdk.min.js.map
