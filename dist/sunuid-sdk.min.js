!function(){"use strict";function e(e,t,n,r,i,o,c){try{var s=e[o](c),a=s.value}catch(e){return void n(e)}s.done?t(a):Promise.resolve(a).then(r,i)}function t(t){return function(){var n=this,r=arguments;return new Promise(function(i,o){var c=t.apply(n,r);function s(t){e(c,i,o,s,a,"next",t)}function a(t){e(c,i,o,s,a,"throw",t)}s(void 0)})}}function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,a(r.key),r)}}function r(e,t,n){return(t=a(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){r(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function c(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */
var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function o(n,r,i,o){var c=r&&r.prototype instanceof u?r:u,l=Object.create(c.prototype);return s(l,"_invoke",function(n,r,i){var o,c,s,u=0,l=i||[],f=!1,d={p:0,n:0,v:e,a:h,f:h.bind(e,4),d:function(t,n){return o=t,c=0,s=e,d.n=n,a}};function h(n,r){for(c=n,s=r,t=0;!f&&u&&!i&&t<l.length;t++){var i,o=l[t],h=d.p,p=o[2];n>3?(i=p===r)&&(s=o[(c=o[4])?5:(c=3,3)],o[4]=o[5]=e):o[0]<=h&&((i=n<2&&h<o[1])?(c=0,d.v=r,d.n=o[1]):h<p&&(i=n<3||o[0]>r||r>p)&&(o[4]=n,o[5]=r,d.n=p,c=0))}if(i||n>1)return a;throw f=!0,r}return function(i,l,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&h(l,p),c=l,s=p;(t=c<2?e:s)||!f;){o||(c?c<3?(c>1&&(d.n=-1),h(c,s)):d.n=s:d.v=s);try{if(u=2,o){if(c||(i="next"),t=o[i]){if(!(t=t.call(o,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,c<2&&(c=0)}else 1===c&&(t=o.return)&&t.call(o),c<2&&(s=TypeError("The iterator does not provide a '"+i+"' method"),c=1);o=e}else if((t=(f=d.n<0)?s:n.call(r,d))!==a)break}catch(t){o=e,c=1,s=t}finally{u=1}}return{value:t,done:f}}}(n,i,o),!0),l}var a={};function u(){}function l(){}function f(){}t=Object.getPrototypeOf;var d=[][r]?t(t([][r]())):(s(t={},r,function(){return this}),t),h=f.prototype=u.prototype=Object.create(d);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,i,"GeneratorFunction")),e.prototype=Object.create(h),e}return l.prototype=f,s(h,"constructor",f),s(f,"constructor",l),l.displayName="GeneratorFunction",s(f,i,"GeneratorFunction"),s(h),s(h,i,"Generator"),s(h,r,function(){return this}),s(h,"toString",function(){return"[object Generator]"}),(c=function(){return{w:o,m:p}})()}function s(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}s=function(e,t,n,r){function o(t,n){s(e,t,function(e){return this._invoke(t,n,e)})}t?i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(o("next",0),o("throw",1),o("return",2))},s(e,t,n,r)}function a(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}
/**
   * SunuID SDK - Package d'int√©gration pour partenaires
   * 
   * @version 1.0.0
   * @author SunuID Team
   * @license MIT
   */!function(e,r){var i={apiUrl:(null===(r=e.SunuIDConfig)||void 0===r?void 0:r.apiUrl)||"https://api.sunuid.fayma.sn",clientId:null,secretId:null,type:1,theme:"light",language:"fr",autoRefresh:!0,refreshInterval:3e4,onSuccess:null,onError:null,onStatusUpdate:null,onExpired:null},s=function(){return r=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=o(o({},i),t),this.qrCode=null,this.refreshTimer=null,this.isInitialized=!1,this.socket=null,this.websocketRetryCount=0,this.maxWebSocketRetries=5,this.init()},s=[{key:"init",value:function(){if(!this.config.clientId||!this.config.secretId)throw new Error("SunuID: clientId et secretId sont requis");this.isInitialized=!0,console.log("SunuID SDK initialis√© avec succ√®s"),this.initWebSocket()}},{key:"initWebSocket",value:function(){var e=this;try{if("undefined"==typeof io)return this.websocketRetryCount++,void(this.websocketRetryCount<=this.maxWebSocketRetries?(console.warn("‚ö†Ô∏è Socket.IO non disponible (tentative ".concat(this.websocketRetryCount,"/").concat(this.maxWebSocketRetries,"), WebSocket sera initialis√© plus tard")),setTimeout(function(){return e.initWebSocket()},1e3)):console.warn("‚ö†Ô∏è Socket.IO non disponible apr√®s plusieurs tentatives, WebSocket d√©sactiv√©"));var t=this.getClientIP();this.socket||(this.socket=io("wss://samasocket.fayma.sn:9443",{query:{token:this.config.clientId,type:"web",userId:this.config.clientId,username:t}}),this.socket.on("connect",function(){console.log("üåê WebSocket connect√© avec succ√®s"),console.log("üìä Socket ID:",e.socket.id)}),this.socket.on("disconnect",function(e){console.log("‚ùå WebSocket d√©connect√©:",e)}),this.socket.on("connect_error",function(e){console.error("‚ùå Erreur connexion WebSocket:",e)}),this.socket.on("qr_status_update",function(t){console.log("üì± Mise √† jour statut QR re√ßue:",t),e.handleQRStatusUpdate(t)}),this.socket.on("qr_scan_success",function(t){console.log("‚úÖ Scan QR r√©ussi re√ßu:",t),e.handleQRScanSuccess(t)}),this.socket.on("qr_expired",function(t){console.log("‚è∞ QR expir√© re√ßu:",t),e.handleQRExpired(t)}))}catch(e){console.error("‚ùå Erreur initialisation WebSocket:",e)}}},{key:"getClientIP",value:function(){return"127.0.0.1"}},{key:"handleQRStatusUpdate",value:function(e){this.config.onStatusUpdate&&this.config.onStatusUpdate(e)}},{key:"handleQRScanSuccess",value:function(e){this.config.onSuccess&&this.config.onSuccess(e)}},{key:"handleQRExpired",value:function(e){this.config.onExpired&&this.config.onExpired(e)}},{key:"emitWebSocketEvent",value:function(e,t){this.socket&&this.socket.connected?(this.socket.emit(e,t),console.log("üì§ √âv√©nement WebSocket √©mis: ".concat(e),t)):"undefined"==typeof io?console.warn("‚ö†Ô∏è Socket.IO non disponible, impossible d'√©mettre l'√©v√©nement:",e):console.warn("‚ö†Ô∏è WebSocket non connect√©, impossible d'√©mettre l'√©v√©nement:",e)}},{key:"getWebSocketStatus",value:function(){return this.socket?this.socket.connected?"connected":"disconnected":"not_initialized"}},{key:"forceWebSocketInit",value:function(){"undefined"==typeof io||this.socket||(console.log("üîÑ For√ßage de l'initialisation WebSocket..."),this.initWebSocket())}},{key:"generateQR",value:(v=t(c().m(function e(t){var n,r,i,s,a=arguments;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:{},this.isInitialized){e.n=1;break}throw new Error("SunuID: SDK non initialis√©");case 1:return e.p=1,e.n=2,this.makeRequest("/qr-generate",o({type:this.config.type},n));case 2:if(!(r=e.v).success){e.n=3;break}return i="".concat("https://sunuid.fayma.sn").concat(r.data.qrcode),this.displayQRCode(t,i,this.config.type,n),this.startAutoRefresh(t,this.config.type,n),this.emitWebSocketEvent("qr_generated",{serviceId:r.data.service_id,type:this.config.type,qrCodeUrl:i,timestamp:Date.now()}),e.a(2,o(o({},r.data),{},{qrCodeUrl:i,sessionId:r.data.service_id}));case 3:throw new Error(r.message||"Erreur lors de la g√©n√©ration du QR code");case 4:e.n=6;break;case 5:throw e.p=5,s=e.v,console.error("Erreur API d√©tect√©e:",s.message),console.log('Affichage du message "Service non disponible" pour type '+this.config.type),this.displayServiceUnavailable(t,this.config.type),new Error("Service non disponible");case 6:return e.a(2)}},e,this,[[1,5]])})),function(e){return v.apply(this,arguments)})},{key:"generateCustomQR",value:(p=t(c().m(function e(t,n){var r,i,s,a,u=arguments;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(r=u.length>2&&void 0!==u[2]?u[2]:{},this.isInitialized){e.n=1;break}throw new Error("SunuID: SDK non initialis√©");case 1:return e.p=1,e.n=2,this.makeRequest("/qr-generate",o({type:n},r));case 2:if(!(i=e.v).success){e.n=3;break}return s="".concat("https://sunuid.fayma.sn").concat(i.data.qrcode),this.displayQRCode(t,s,n,r),this.startAutoRefresh(t,n,r),e.a(2,o(o({},i.data),{},{qrCodeUrl:s,sessionId:i.data.service_id}));case 3:throw new Error(i.message||"Erreur lors de la g√©n√©ration du QR code");case 4:e.n=6;break;case 5:throw e.p=5,a=e.v,console.error("Erreur API d√©tect√©e:",a.message),console.log('Affichage du message "Service non disponible" pour type '+n),this.displayServiceUnavailable(t,n),new Error("Service non disponible");case 6:return e.a(2)}},e,this,[[1,5]])})),function(e,t){return p.apply(this,arguments)})},{key:"generateAuthQR",value:(h=t(c().m(function e(t){var n,r=arguments;return c().w(function(e){for(;;)if(0===e.n)return n=r.length>1&&void 0!==r[1]?r[1]:{},e.a(2,this.generateQR(t,n))},e,this)})),function(e){return h.apply(this,arguments)})},{key:"generateKYCQR",value:(d=t(c().m(function e(t){var n,r,i=arguments;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},r=this.config.type,this.config.type=2,e.p=1,e.n=2,this.generateQR(t,n);case 2:return e.a(2,e.v);case 3:return e.p=3,this.config.type=r,e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])})),function(e){return d.apply(this,arguments)})},{key:"checkQRStatus",value:(f=t(c().m(function e(t){var n,r;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.isInitialized){e.n=1;break}throw new Error("SunuID: SDK non initialis√©");case 1:return e.p=1,e.n=2,this.makeRequest("/qr-status",{serviceId:t});case 2:if(!(n=e.v).success){e.n=3;break}return e.a(2,n.data);case 3:throw new Error(n.message||"Erreur lors de la v√©rification du statut");case 4:e.n=6;break;case 5:throw e.p=5,r=e.v,this.handleError(r),r;case 6:return e.a(2)}},e,this,[[1,5]])})),function(e){return f.apply(this,arguments)})},{key:"displayQRCode",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=document.getElementById(e);if(!i)throw new Error("Conteneur avec l'ID \"".concat(e,'" non trouv√©'));i.innerHTML="";var o=document.createElement("div");o.className="sunuid-qr-code",o.innerHTML='\n                    <div class="sunuid-qr-header">\n                    <h3>'.concat(1===n?"Authentification":2===n?"V√©rification KYC":3===n?"Service Type 3":"Service Type "+n,'</h3>\n                    </div>\n                <div class="sunuid-qr-image">\n                    <img src="').concat(t,'" alt="QR Code SunuID" style="max-width: 300px; height: auto;">\n                    </div>\n                <div class="sunuid-qr-instructions">\n                    <p>Scannez ce QR code avec l\'application SunuID pour vous connecter</p>\n                    </div>\n                <div class="sunuid-qr-status" id="sunuid-status">\n                    <p>En attente de scan...</p>\n                </div>\n            '),i.appendChild(o),this.applyTheme(r.theme||this.config.theme)}},{key:"displayServiceUnavailable",value:function(e,t){console.log("displayServiceUnavailable appel√©e pour ".concat(e,", type: ").concat(t));var n=document.getElementById(e);n?n.innerHTML='\n                <div class="sunuid-service-unavailable" style="\n                    text-align: center;\n                    padding: 40px 20px;\n                    background: #f8f9fa;\n                    border: 2px dashed #dee2e6;\n                    border-radius: 10px;\n                    color: #6c757d;\n                    font-family: Arial, sans-serif;\n                ">\n                    <div style="font-size: 48px; margin-bottom: 20px;">‚ö†Ô∏è</div>\n                    <h3 style="margin: 0 0 10px 0; color: #495057;">Service Non Disponible</h3>\n                    <p style="margin: 0; font-size: 14px;">\n                        Le service d\'authentification est temporairement indisponible.<br>\n                        Veuillez r√©essayer plus tard.\n                    </p>\n                    <div style="margin-top: 20px; font-size: 12px; color: #adb5bd;">\n                        Type: '.concat(t.toUpperCase(),"\n                    </div>\n                </div>\n            "):console.error("Container ".concat(e," non trouv√©"))}},{key:"refreshQR",value:(l=t(c().m(function e(t){var n,r,i,o=arguments;return c().w(function(e){for(;;)switch(e.p=e.n){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},e.p=1,e.n=2,this.generateQR(t,n);case 2:return r=e.v,e.a(2,r);case 3:throw e.p=3,i=e.v,console.error("Erreur lors du rafra√Æchissement:",i.message),this.displayServiceUnavailable(t,this.config.type),i;case 4:return e.a(2)}},e,this,[[1,3]])})),function(e){return l.apply(this,arguments)})},{key:"startAutoRefresh",value:function(e,n,r){var i=this;this.config.autoRefresh&&(this.refreshTimer=setInterval(t(c().m(function t(){var o;return c().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,i.refreshQR(e,n,r);case 1:t.n=3;break;case 2:t.p=2,o=t.v,console.warn("Erreur lors du rafra√Æchissement automatique:",o);case 3:return t.a(2)}},t,null,[[0,2]])})),this.config.refreshInterval))}},{key:"makeRequest",value:(u=t(c().m(function t(n,r){var i,s,a,u,l,f,d,h;return c().w(function(t){for(;;)switch(t.p=t.n){case 0:return s=(null===(i=e.SunuIDConfig)||void 0===i||null===(i=i.endpoints)||void 0===i?void 0:i[n.replace("/","")])||n,a="".concat(this.config.apiUrl).concat(s),void 0!==r.type&&console.log("üåê Envoi requ√™te API - Type: ".concat(r.type,", Endpoint: ").concat(n)),t.p=1,t.n=2,fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(this.config.clientId,":").concat(this.config.secretId),Accept:"application/json"},body:JSON.stringify(o(o({},r),{},{client_id:this.config.clientId,secret_id:this.config.secretId}))});case 2:if((u=t.v).ok){t.n=4;break}return t.n=3,u.text();case 3:l=t.v;try{f=JSON.parse(l)}catch(e){f={message:l}}throw new Error(f.message||"Erreur HTTP: ".concat(u.status));case 4:return t.n=5,u.json();case 5:return d=t.v,t.a(2,d);case 6:throw t.p=6,h=t.v,console.error("Erreur API SunuID:",h),h;case 7:return t.a(2)}},t,this,[[1,6]])})),function(e,t){return u.apply(this,arguments)})},{key:"applyTheme",value:function(e){var t=document.querySelector(".sunuid-qr-code");t&&(t.className="sunuid-qr-code sunuid-theme-".concat(e))}},{key:"handleError",value:function(e){console.error("SunuID SDK Error:",e),this.config.onError&&this.config.onError(e)}},{key:"destroy",value:function(){this.refreshTimer&&clearInterval(this.refreshTimer),this.socket&&(this.socket.disconnect(),this.socket=null,console.log("üåê WebSocket d√©connect√©")),this.isInitialized=!1,console.log("SunuID SDK d√©truit")}}],s&&n(r.prototype,s),a&&n(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,s,a,u,l,f,d,h,p,v}();e.SunuID=s,e.sunuidInstance=null,e.initSunuID=function(t){try{return e.sunuidInstance=new s(t),e.sunuidInstance}catch(e){throw console.error("Erreur lors de l'initialisation de SunuID:",e),e}}}(window)}();
//# sourceMappingURL=sunuid-sdk.min.js.map
